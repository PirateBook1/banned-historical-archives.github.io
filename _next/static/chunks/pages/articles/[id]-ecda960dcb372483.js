(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[977],{1333:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(7918),i=n(5893);function c(e){var t=e.authors;return(0,i.jsx)(i.Fragment,{children:t.map(function(e){return(0,i.jsx)(r.Z,{onClick:function(){return window.open("/articles?author=".concat(encodeURIComponent(e)),"_blank")},sx:{m:.3},label:e},e)})})}},2466:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(5861),i=n(5893);function c(e){var t=e.diff;return t?(0,i.jsx)(i.Fragment,{children:t.map(function(e,t){return(0,i.jsx)(r.Z,{variant:"body1",sx:{margin:.5},children:e.map(function(e,t){return(0,i.jsx)("span",{style:{color:1===e[0]?"green":-1===e[0]?"red":"inherit"},children:e[1]},t)})},t)})}):null}},3146:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(7918),i=n(5861),c=n(7294),o=n(4564),s=n(5893);function a(e){var t=e.tags,n=(0,c.useState)(null),a=n[0],l=n[1],u=(0,c.useState)(""),d=u[0],f=u[1],h=function(){l(null)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.ZP,{open:!!a,anchorEl:a,disableRestoreFocus:!0,sx:{pointerEvents:"none"},anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,s.jsx)(i.Z,{sx:{p:2},children:d})}),t.map(function(e){return(0,s.jsx)(r.Z,{onMouseEnter:function(t){f(e.type),l(t.currentTarget)},onMouseLeave:h,onClick:function(){return window.open("/articles?tag=".concat(encodeURIComponent(e.name)),"_blank")},sx:{m:.3},label:e.name},e.type+"##"+e.name)})]})}},2161:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return el},default:function(){return eu}});var r,i,c=n(8307),o=n(7812),s=n(7294),a=n(2027),l=n(9008),u=n.n(l),d=n(8360),f=n(5464),h=n(3841),x=n(4054),p=n(6886),m=n(7709),j=n(431),g=n(7918),v=n(1057),b=n(6447),Z=n(7720),y=n(5861),w=n(9800),_=n(2846),C=n(2466),O=n(3146),S=n(1333),k=n(5158),A=n(6522),z=n(7349),P=n(7380),E=n(4564),I=n(1903),B=n(657),R=n(7645),M=n(6863),D=n(480),F=n(9368),N=n(5893);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function W(e){var t=U(U({},e),{},{insertBefore:e.insertBefore.map(function(e){return{text:e.text}}),insertAfter:e.insertAfter.map(function(e){return{text:e.text}})});return t.insertBefore.length||delete t.insertBefore,t.insertAfter.length||delete t.insertAfter,t}function H(e){var t=e.onClose,n=(0,s.useState)(""),r=n[0],i=n[1];return(0,N.jsxs)(B.Z,{onClose:function(){return t()},open:!0,children:[(0,N.jsx)(R.Z,{children:"插入"}),(0,N.jsxs)(b.Z,{spacing:2,p:2,children:[(0,N.jsx)(I.Z,{size:"small",value:r,onChange:function(e){return i(e.target.value)},multiline:!0,autoFocus:!0}),(0,N.jsxs)(M.Z,{children:[(0,N.jsx)(v.Z,{onClick:function(){return t(r)},children:"确定"}),(0,N.jsx)(v.Z,{onClick:function(){return t()},children:"取消"})]})]})]})}function X(e){var t=e.content,n=e.onChange,r=(0,s.useState)(!1),i=r[0],c=r[1],l=(0,s.useState)(!1),u=l[0],d=l[1],f=(0,s.useState)([]),h=f[0],x=f[1],p=(0,s.useState)([]),m=p[0],j=p[1],g=(0,s.useState)(!t),Z=g[0],y=g[1],w=(0,s.useRef)({insertBefore:[],insertAfter:[]}),_=(0,s.useState)(t),C=_[0],O=_[1],S=(0,N.jsxs)(b.Z,{direction:"row",sx:{mt:1,mb:1},spacing:1,children:[(0,N.jsx)(I.Z,{sx:{flex:1},size:"small",onChange:function(e){var r=U({},w.current);if(e.target.value.length){delete r.delete,y(!1);var i=new a.diff_match_patch().diff_main(t,e.target.value);t?1!==i.length?r.diff=new a.diff_match_patch().diff_toDelta(i):delete r.diff:r.diff=new a.diff_match_patch().diff_toDelta(i)}else r.delete=!0,y(!0);w.current=r,n(W(r)),O(e.target.value)},value:C,multiline:!0}),(0,N.jsxs)(b.Z,{spacing:1,children:[(0,N.jsx)(v.Z,{size:"small",variant:"outlined",onClick:function(){return c(!0)},children:"上方插入"}),(0,N.jsx)(v.Z,{size:"small",variant:"outlined",onClick:function(){return d(!0)},children:"下方插入"}),(0,N.jsx)(D.Z,{control:(0,N.jsx)(F.Z,{size:"small",checked:Z,onChange:function(e){C.length&&(y(e.target.checked),w.current=U(U({},w.current),{},{delete:e.target.checked}),n(W(w.current)))}}),label:"删除"})]})]});return(0,N.jsxs)(N.Fragment,{children:[h.map(function(e){return(0,N.jsx)("li",{children:(0,N.jsxs)(b.Z,{direction:"row",spacing:1,children:[(0,N.jsx)(I.Z,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),(0,N.jsx)(v.Z,{variant:"outlined",size:"small",onClick:function(){w.current.insertBefore=h.filter(function(t){return t.id!==e.id}),x(w.current.insertBefore),n(W(w.current))},children:"删除"})]})},e.id)}),i?(0,N.jsx)(H,{onClose:function(e){if(!e){c(!1);return}var t=[].concat((0,o.Z)(h),[{id:Math.random().toString(),text:e}]);x(t),c(!1),w.current.insertBefore=t,n(W(w.current))}}):null,u?(0,N.jsx)(H,{onClose:function(e){if(!e){d(!1);return}var t=[].concat((0,o.Z)(m),[{id:Math.random().toString(),text:e}]);j(t),d(!1),w.current.insertAfter=t,n(W(w.current))}}):null,Z?S:(0,N.jsx)("li",{children:S},"center"),m.map(function(e){return(0,N.jsx)("li",{children:(0,N.jsxs)(b.Z,{direction:"row",spacing:1,children:[(0,N.jsx)(I.Z,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),(0,N.jsx)(v.Z,{variant:"outlined",size:"small",onClick:function(){w.current.insertAfter=m.filter(function(t){return t.id!==e.id}),j(w.current.insertAfter),n(W(w.current))},children:"删除"})]})},e.id)})]})}function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Y(e){var t=e.onClose,n=(0,s.useState)(""),r=n[0],i=n[1],c=(0,s.useState)(P.zc.paragraph),o=c[0],a=c[1];return(0,N.jsxs)(B.Z,{onClose:function(){return t()},open:!0,children:[(0,N.jsx)(R.Z,{children:"插入段落"}),(0,N.jsxs)(b.Z,{spacing:2,p:2,children:[(0,N.jsx)(I.Z,{size:"small",value:r,onChange:function(e){return i(e.target.value)},multiline:!0,autoFocus:!0}),(0,N.jsx)(y.Z,{children:"类型："}),(0,N.jsx)(d.Z,{sx:{width:130},size:"small",defaultValue:o,onChange:function(e){a(e.target.value)},children:Object.keys(P.zc).map(function(e){return(0,N.jsx)(j.Z,{value:e,children:e},e)})}),(0,N.jsxs)(M.Z,{children:[(0,N.jsx)(v.Z,{onClick:function(){return t(o,r)},children:"确定"}),(0,N.jsx)(v.Z,{onClick:function(){return t()},children:"取消"})]})]})]})}function V(e){var t=L(L({},e),{},{insertBefore:e.insertBefore.map(function(e){return{type:e.type,text:e.text}}),insertAfter:e.insertAfter.map(function(e){return{type:e.type,text:e.text}})});return t.insertBefore.length||delete t.insertBefore,t.insertAfter.length||delete t.insertAfter,t}function J(e){var t=e.idx,n=e.content,r=e.comments,i=e.onChange,c=(0,s.useState)(!1),l=c[0],u=c[1],f=(0,s.useState)(!1),h=f[0],x=f[1],p=(0,s.useState)([]),m=p[0],g=p[1],Z=(0,s.useState)([]),w=Z[0],_=Z[1],C=(0,s.useState)(!1),O=C[0],S=C[1],A=(0,s.useRef)({insertBefore:[],insertAfter:[]}),z=(0,s.useMemo)(function(){var e=Array.from(n.text);return r.filter(function(e){return e.part_idx===t}).sort(function(e,t){return t.index-e.index}).forEach(function(t){return e.splice(t.offset,0,"".concat(k.oW).concat(t.index).concat(k.Pc))}),e.join("")},[n,r,t]),E=(0,s.useState)(z),B=E[0],R=E[1];return(0,N.jsxs)(N.Fragment,{children:[m.map(function(e){return(0,N.jsxs)(b.Z,{direction:"row",spacing:1,children:[(0,N.jsx)(I.Z,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),(0,N.jsx)(y.Z,{variant:"caption",children:e.type}),(0,N.jsx)(v.Z,{variant:"outlined",size:"small",onClick:function(){A.current.insertBefore=m.filter(function(t){return t.id!==e.id}),g(A.current.insertBefore),i(V(A.current))},children:"删除"})]},e.id)}),l?(0,N.jsx)(Y,{onClose:function(e,t){if(e&&t){var n=[].concat((0,o.Z)(m),[{id:Math.random().toString(),type:e,text:t}]);g(n),u(!1),A.current.insertBefore=n,i(V(A.current))}}}):null,h?(0,N.jsx)(Y,{onClose:function(e,t){if(e&&t){var n=[].concat((0,o.Z)(w),[{id:Math.random().toString(),type:e,text:t}]);_(n),x(!1),A.current.insertAfter=n,i(V(A.current))}}}):null,(0,N.jsxs)(b.Z,{direction:"row",sx:{mt:1,mb:1},spacing:1,children:[(0,N.jsx)(I.Z,{sx:{flex:1},size:"small",onChange:function(e){var t=L({},A.current);if(e.target.value.length){delete t.delete,S(!1);var n=new a.diff_match_patch().diff_main(z,e.target.value);1===n.length&&z?delete t.diff:t.diff=new a.diff_match_patch().diff_toDelta(n)}else t.delete=!0,delete t.diff,S(!0);A.current=t,i(V(t)),R(e.target.value)},value:B,multiline:!0},n.id),(0,N.jsxs)(b.Z,{spacing:1,children:[(0,N.jsx)(d.Z,{sx:{width:130},size:"small",defaultValue:n.type,onChange:function(e){A.current=L(L({},A.current),{},{type:e.target.value}),i(V(A.current))},children:Object.keys(P.zc).map(function(e){return(0,N.jsx)(j.Z,{value:e,children:e},e)})}),(0,N.jsx)(v.Z,{size:"small",variant:"outlined",onClick:function(){return u(!0)},children:"上方插入"}),(0,N.jsx)(v.Z,{size:"small",variant:"outlined",onClick:function(){return x(!0)},children:"下方插入"}),(0,N.jsx)(D.Z,{control:(0,N.jsx)(F.Z,{size:"small",checked:O,onChange:function(e){B.length&&(S(e.target.checked),A.current=L(L({},A.current),{},{delete:e.target.checked}),i(V(A.current)))}}),label:"删除"})]})]}),w.map(function(e){return(0,N.jsxs)(b.Z,{direction:"row",spacing:1,children:[(0,N.jsx)(I.Z,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),(0,N.jsx)(y.Z,{variant:"caption",children:e.type}),(0,N.jsx)(v.Z,{variant:"outlined",size:"small",onClick:function(){A.current.insertAfter=w.filter(function(t){return t.id!==e.id}),_(A.current.insertAfter),i(V(A.current))},children:"删除"})]},e.id)})]})}var G=n(3454).env.COMMIT_HASH;function Q(e){var t,n=e.contents,r=e.comments,i=(e.description,e.article),c=e.articleId,l=e.publicationId,u=e.publicationName,d=(0,s.useRef)({version:2,parts:{},comments:{},description:""}),f=(0,s.useState)(""),h=f[0],x=f[1],p=(0,s.useState)(null),m=p[0],j=p[1];return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(b.Z,{sx:{mb:1},spacing:1,direction:"row",children:(0,N.jsx)(v.Z,{variant:"outlined",size:"small",onClick:function(){return window.open("https://github.com/banned-historical-archives/banned-historical-archives.github.io/wiki/%E6%A0%87%E5%87%86%E5%8C%96%E6%96%87%E7%A8%BF%E5%BD%95%E5%85%A5%E4%B8%8E%E6%A0%A1%E5%AF%B9","_blank")},children:"校对注意事项"})}),(0,N.jsx)(E.ZP,{open:!!m,anchorEl:m,onClose:function(){return j(null)},children:(0,N.jsx)(I.Z,{multiline:!0,value:h})}),n.map(function(e,t){return(0,N.jsx)(J,{onChange:function(n){n.diff||n.delete||n.type&&n.type!==e.type||n.insertAfter||n.insertBefore?d.current.parts[t]=n:delete d.current.parts[t]},idx:t,comments:r,content:e},e.id)}),(0,N.jsx)(Z.Z,{sx:{mt:2,mb:2}}),(0,N.jsx)(y.Z,{variant:"h6",sx:{mb:2},children:"描述"}),(t=r.find(function(e){return -1===e.index})||{index:-1,text:""},(0,N.jsx)(I.Z,{defaultValue:t.text,multiline:!0,onChange:function(e){if(0===e.target.value.length){delete d.current.description;return}var n=new a.diff_match_patch().diff_main(t.text,e.target.value);t.text&&1===n.length?d.current.description="":d.current.description=new a.diff_match_patch().diff_toDelta(n)}})),(0,N.jsx)(Z.Z,{sx:{mt:2,mb:2}}),(0,N.jsx)(y.Z,{variant:"h6",sx:{mb:2},children:"注释"}),(0,N.jsx)("ol",{children:r.filter(function(e){return -1!==e.index}).length?r.filter(function(e){return -1!==e.index}).map(function(e,t){return(0,N.jsx)(X,{content:e.text,onChange:function(t){t.diff||t.delete||t.insertAfter||t.insertBefore?d.current.comments[e.index]=t:delete d.current.comments[e.index]}},t)}):(0,N.jsx)(X,{content:"",onChange:function(e){e.diff||e.insertAfter||e.insertBefore?d.current.newComments=[].concat((0,o.Z)((e.insertBefore||[]).map(function(e){return e.text})),(0,o.Z)(e.diff?[new a.diff_match_patch().diff_fromDelta("",e.diff).filter(function(e){return -1!==e[0]}).map(function(e){return e[1]}).join("")]:[]),(0,o.Z)((e.insertAfter||[]).map(function(e){return e.text}))):delete d.current.newComments}},"virtual")}),(0,N.jsxs)(b.Z,{spacing:1,children:[(0,N.jsx)(v.Z,{variant:"contained",size:"small",sx:{width:80,mt:1},onClick:function(){var e=JSON.stringify({articleId:c,publicationId:l,commitHash:G,patch:d.current}),t="https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues/new?title=".concat(encodeURIComponent("[OCR patch]".concat(i.title,"[").concat(u,"][").concat(c,"][").concat(l,"]")),"&body=").concat(encodeURIComponent("{OCR补丁}\n".concat(e,"\n请复制以上代码在对比选项中粘贴进行预览：https://banned-historical-archives.github.io/articles/").concat(c,"\n")));window.open(t,"_blank")},children:"提交变更"}),(0,N.jsxs)(y.Z,{children:["如果出现 Your request URL is too long 的错误，请点击",(0,N.jsx)(v.Z,{size:"small",onClick:function(e){var t=JSON.stringify({articleId:c,publicationId:l,commitHash:G,patch:d.current}),n="{OCR补丁}\n".concat(t,"\n请复制以上代码在对比选项中粘贴进行预览：https://banned-historical-archives.github.io/articles/").concat(c);navigator.clipboard.writeText(n);var r="https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues/new?title=".concat(encodeURIComponent("[OCR patch]".concat(i.title,"[").concat(u,"][").concat(c,"][").concat(l,"]")));window.open(r,"_blank"),x(n),j(e.currentTarget)},children:"复制代码并跳转"}),"，粘贴代码再提交。"]}),(0,N.jsx)(y.Z,{children:"如果核对无误也可以提交，使其他人知道此文稿已经被校对（可多次提交，表示多次核对）"})]})]})}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function K(e){var t=e.description,n=e.comments,r=e.contents,i=(0,s.useState)(!1),c=i[0],o=i[1],a=r.map(function(e){var t=[],r=n.filter(function(t){return t.part_idx===e.index}),i=e.text,c=0,o=[];if(r.length){var s,a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(e,t)}}(e))){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,c=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw c}}}}(r);try{for(a.s();!(s=a.n()).done;){var l=s.value,u=i.substr(c,l.offset-c);o.push(u),c+=u.length}}catch(e){a.e(e)}finally{a.f()}c<i.length&&o.push(i.substr(c))}else o.push(i);var d=[];o.forEach(function(e,n){if(d.push((0,N.jsx)("span",{children:e},"".concat((0,k.bd)(e),"-").concat(n))),t.push(e),r.length){var i=r.shift().index;t.push("〔".concat(i,"〕")),d.push((0,N.jsxs)("a",{href:"#comment".concat(i),style:{userSelect:"none"},children:[k.oW,i,k.Pc]},Math.random()))}}),e.type===P.zc.title?t.unshift("# "):e.type===P.zc.subtitle?t.unshift("## "):e.type===P.zc.subtitle2?t.unshift("### "):e.type===P.zc.subtitle3&&t.unshift("#### ");var f=e.id;if(e.type===P.zc.title)return(0,N.jsx)(y.Z,{variant:"h5",sx:{textAlign:"center",margin:4},children:d},f);if(e.type===P.zc.appellation)return(0,N.jsx)(y.Z,{variant:"body1",sx:{margin:.5,fontWeight:"bold"},children:d},f);if(e.type===P.zc.image)return(0,N.jsx)("img",{alt:"",src:e.text,style:{width:"50%",margin:"auto",marginTop:"1.25em"}},f);if(e.type===P.zc.image_description)return(0,N.jsx)(y.Z,{variant:"subtitle1",sx:{textAlign:"center",marginBottom:"1.25em"},children:d},f);if(e.type===P.zc.subdate)return(0,N.jsx)(y.Z,{variant:"subtitle1",sx:{textAlign:"center"},children:d},f);if(e.type===P.zc.place)return(0,N.jsx)(y.Z,{variant:"subtitle1",sx:{textAlign:"center"},children:d},f);if(e.type===P.zc.authors)return(0,N.jsx)(y.Z,{variant:"subtitle1",sx:{textAlign:"center"},children:d},f);else if(e.type===P.zc.signature)return(0,N.jsx)(y.Z,{variant:"subtitle1",sx:{textAlign:"right"},children:d},f);else if(e.type===P.zc.subtitle)return(0,N.jsx)(y.Z,{variant:"subtitle1",sx:{textAlign:"center",fontSize:"1.5em",fontWeight:"bold",margin:"1.25em 0 1.25em 0"},children:d},f);else if(e.type===P.zc.subtitle2)return(0,N.jsx)(y.Z,{variant:"subtitle1",sx:{textAlign:"center",fontSize:"1.17em",fontWeight:"bold",margin:"1.25em 0 1.25em 0"},children:d},f);else if(e.type===P.zc.subtitle3)return(0,N.jsx)(y.Z,{variant:"subtitle1",sx:{textAlign:"center",fontWeight:"bold",margin:"0.625em 0 0.625em 0"},children:d},f);else if(e.type===P.zc.subtitle4||e.type===P.zc.subtitle5)return(0,N.jsx)(y.Z,{variant:"subtitle1",sx:{textAlign:"center"},children:d},f);else if(e.type===P.zc.paragraph)return(0,N.jsx)(y.Z,{variant:"body1",sx:{textIndent:"2em",margin:.5},children:d},f);else if(e.type===P.zc.quotation)return(0,N.jsx)(b.Z,{spacing:1,children:e.text.split("\n").filter(function(e){return e}).map(function(e,t){return(0,N.jsx)(y.Z,{variant:"body1",sx:{color:"grey",padding:"0.625em 2.5em 0.625em 2.5em",borderLeft:"2px solid"},children:e},t)})},f);else return(0,N.jsx)(y.Z,{variant:"body1",sx:{textIndent:"2em",margin:.5},children:d},f)}),l=t?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(Z.Z,{sx:{mt:2,mb:2}}),(0,N.jsx)(y.Z,{variant:"h6",sx:{mb:2},children:"描述"}),(0,N.jsx)(b.Z,{spacing:1,children:t.split("\n").filter(function(e){return e}).map(function(e,t){return(0,N.jsx)(y.Z,{variant:"body1",children:e},t)})})]}):null,u=n.filter(function(e){return -1!==e.index}).length?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(Z.Z,{sx:{mt:2,mb:2}}),(0,N.jsx)(y.Z,{variant:"h6",sx:{mb:2},children:"注释"}),n.filter(function(e){return -1!==e.index}).map(function(e){return(0,N.jsxs)(b.Z,{direction:"row",id:"comment".concat(e.index),children:[(0,N.jsxs)("span",{style:{userSelect:"none"},children:[k.oW,e.index,k.Pc]}),(0,N.jsx)(b.Z,{spacing:1,children:e.text.split("\n").filter(function(e){return e}).map(function(e,t){return(0,N.jsx)(y.Z,{variant:"body1",children:e},t)})})]},e.id)})]}):null;return(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)("div",{style:{position:"relative"},children:[(0,N.jsx)(v.Z,{sx:{position:"absolute",top:4,left:0,minWidth:0,opacity:"0.5",width:"20px",height:"20px",borderRadius:"10px"},onClick:function(){if(o(!c),c)speechSynthesis.cancel();else{var e=new SpeechSynthesisUtterance(r.map(function(e){return e.text}).join("\n"));e.voice=speechSynthesis.getVoices().find(function(e){return"zh-CN"==e.lang}),e.pitch=.5,e.rate=1,speechSynthesis.speak(e)}},children:c?(0,N.jsx)(z.Z,{}):(0,N.jsx)(A.Z,{})}),a,l,u]})})}function ee(e){var t=e.article,n=e.articleId,r=e.comments,i=e.patchable,c=e.contents,o=e.publicationId,s=e.publicationName,a=e.description;return c=c.sort(function(e,t){return e.index>t.index?1:-1}),r=r.sort(function(e,t){return e.index-t.index}),i?(0,N.jsx)(Q,{articleId:n,article:t,comments:r,contents:c,description:a,publicationId:o,publicationName:s}):(0,N.jsx)(K,{description:a,comments:r,contents:c})}var et=n(3454);function en(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?en(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):en(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}w.v0.GlobalWorkerOptions.workerSrc="/pdfjs-dist/legacy/build/pdf.worker.min.js",et.env.COMMIT_HASH;var ei="--preview-patch--",ec=((r=ec||{}).none="none",r.origin="origin",r.originProofread="originProofread",r.version="version",r);function eo(e){var t="";return e.forEach(function(e){return t+=e.text}),t}function es(e){return[e.year||"",e.month||"",e.day||""].filter(function(e){return e}).join(".")}var ea=((i=ea||{}).line="逐行对比",i.literal="逐字对比",i.description_and_comments="描述和注释",i),el=!0;function eu(e){var t,r=e.books,i=(0,s.useState)(),c=i[0],l=i[1],_=(0,s.useRef)(r),A=(0,s.useState)(1),z=A[0],P=A[1],E=(0,s.useState)(!0),I=E[0],B=E[1],R=(0,s.useState)(null),M=R[0],D=R[1],F=(0,s.useState)(ec.none),T=F[0],U=F[1],W=(0,s.useState)(r[r.length-1].id),H=W[0],X=W[1],q=(0,s.useState)(ea.line),L=q[0],Y=q[1],V=(0,s.useState)(r[0].id),J=V[0],G=V[1],Q=(0,s.useCallback)(function(e,t){_.current=_.current.filter(function(e){return e.id!=ei}),_.current.push({id:ei,type:"",tags:[],files:[],name:"#OCR补丁预览#",article:(0,k.Az)(_.current.find(function(t){return t.id==e}).article,t)})},[]);(0,s.useEffect)(function(){var e=new URLSearchParams(location.search);e.get("publication_id")&&G(e.get("publication_id"))},[]);var $=(0,s.useMemo)(function(){if(T!==ec.version)return[];var e=_.current.find(function(e){return e.id==J}).article,t=_.current.find(function(e){return e.id==H}).article,n=e.comments,r=t.comments,i=e.parts,c=t.parts;if(L===ea.literal)return[new a.diff_match_patch().diff_main(eo([{text:eo(i)}]),eo([{text:eo(c)}]))];if(L===ea.description_and_comments){var s=Math.max(n.length,r.length);return[new a.diff_match_patch().diff_main(e.description||"",t.description||"")].concat((0,o.Z)(Array(s).fill(0).map(function(e,t){return new a.diff_match_patch().diff_main(n[t]||"",r[t]||"")})))}for(var l=Math.max(i.length,c.length),u=0,d=[];u<l;){var f=i[u]?i[u].text:"",h=c[u]?c[u].text:"";d.push(new a.diff_match_patch().diff_main(f,h)),++u}return d},[J,T,L,H]),K=!!M;null===(t=(n.g||window).location)||void 0===t||t.hostname;var et=_.current.find(function(e){return e.id==J}),en=_.current.find(function(e){return e.id==H}),el=et.article,eu=[];_.current.forEach(function(e){e.article.alias&&eu.push(e.article.alias)});var ed=el.description,ef=el.parts,eh=el.comments,ex=el.page_start,ep=el.page_end,em=el.comment_pivots,ej=eh.map(function(e,t){var n,r,i;return{text:e,id:t.toString(),offset:null===(n=em[t])||void 0===n?void 0:n.offset,index:null===(r=em[t])||void 0===r?void 0:r.index,part_idx:null===(i=em[t])||void 0===i?void 0:i.part_idx}}),eg=ef.map(function(e,t){return er(er({},e),{},{index:t,id:t.toString()})}),ev=en.article.comments.map(function(e,t){return er({text:e,id:t.toString()},em[t])}),eb=en.article.parts.map(function(e,t){return er(er({},e),{},{index:t,id:t.toString()})}),eZ=new Map;if(_.current.forEach(function(e){e.tags.forEach(function(e){eZ.set(e.type+"##"+e.name,e)})}),(0,s.useEffect)(function(){l(location.pathname.split("/").slice(-1)[0])},[]),!c)return null;var ey=[];ey.push((0,N.jsx)(b.Z,{sx:{flex:1,overflowY:"scroll",p:1},children:(0,N.jsx)(ee,{article:el,articleId:c,publicationId:J,publicationName:et.name,description:ed,comments:ej,contents:eg,patchable:T===ec.originProofread})},"version_a")),T===ec.origin||T===ec.originProofread?ey.push((0,N.jsxs)(b.Z,{sx:{flex:1,overflowY:"scroll"},children:[(0,N.jsxs)(b.Z,{direction:"row",spacing:"10px",sx:{position:"fixed",bottom:20,right:20,zIndex:1,opacity:.7},children:[(0,N.jsx)(v.Z,{onClick:function(){return P(z+.1)},variant:"contained",sx:{borderRadius:"100%",width:"50px",minWidth:"50px",height:"50px"},children:"+"}),(0,N.jsx)(v.Z,{onClick:function(){return P(z-.1)},variant:"contained",sx:{borderRadius:"100%",width:"50px",minWidth:"50px",height:"50px"},children:"-"})]}),"db"!==et.type?"pdf"===et.type?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(y.Z,{variant:"subtitle1",children:["来源文件(页码",ex,"-",ep,")",(0,N.jsx)("a",{href:et.files[0],target:"__blank",children:"[下载]"})]}),(0,N.jsx)(w.BB,{file:et.files[0]||"",options:{cMapUrl:"/pdfjs-dist/cmaps/",cMapPacked:!0},children:Array(ep-ex+1).fill(0).map(function(e,t){return(0,N.jsx)(w.T3,{pageNumber:t+ex,width:500*z},t)})})]}):"img"===et.type?et.files.filter(function(e,t){return t+1>=ex&&t+1<=ep}).map(function(e){return(0,N.jsx)("img",{alt:"",src:e,width:500*z},e)}):(0,N.jsx)(N.Fragment,{children:"未知类型"}):"无法预览（来自数据库文件）"]},"origin")):T===ec.version&&ey.push((0,N.jsxs)(b.Z,{sx:{flex:1},children:[(0,N.jsxs)(x.Z,{children:[(0,N.jsx)(h.Z,{children:"对比目标"}),(0,N.jsx)(d.Z,{size:"small",value:H,input:(0,N.jsx)(m.Z,{label:"对比目标"}),onChange:function(e){X(e.target.value)},children:_.current.map(function(e){return(0,N.jsx)(j.Z,{value:e.id,children:e.name},e.id)})})]}),(0,N.jsx)(b.Z,{sx:{overflowY:"scroll"},children:(0,N.jsx)(ee,{description:en.article.description,articleId:c,article:en.article,publicationId:H,comments:ev,contents:eb})})]},"version_b"),(0,N.jsxs)(b.Z,{sx:{flex:1},children:[(0,N.jsxs)(x.Z,{children:[(0,N.jsx)(h.Z,{children:"对比模式"}),(0,N.jsxs)(d.Z,{size:"small",value:L,input:(0,N.jsx)(m.Z,{label:"对比模式"}),onChange:function(e){Y(e.target.value)},children:[(0,N.jsx)(j.Z,{value:ea.line,children:ea.line}),(0,N.jsx)(j.Z,{value:ea.literal,children:ea.literal}),(0,N.jsx)(j.Z,{value:ea.description_and_comments,children:ea.description_and_comments})]})]}),(0,N.jsx)(b.Z,{sx:{overflowY:"scroll"},children:(0,N.jsx)(C.Z,{diff:$})})]},"result"));var ew=(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,N.jsxs)(b.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,N.jsx)(y.Z,{variant:"body1",children:"作者："}),(0,N.jsx)(b.Z,{direction:"row",sx:{overflowX:"scroll",flex:1},children:(0,N.jsx)(S.Z,{authors:el.authors})}),_.current.map(function(e){return(0,N.jsx)("img",{alt:"",style:{cursor:"pointer"},onClick:function(){return window.open("https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues?q=+".concat(encodeURIComponent('is:issue "'.concat(c,'" "').concat(e.id,'"')),"+"),"_blank")},src:"https://img.shields.io/github/issues-search/banned-historical-archives/banned-historical-archives.github.io?style=for-the-badge&color=%23cc0000&label=%E6%A0%A1%E5%AF%B9%E8%AE%B0%E5%BD%95&query=".concat(encodeURIComponent('is:issue "'.concat(c,'" "').concat(e.id,'"')))},e.id)})]})}),(0,N.jsx)(p.ZP,{item:!0,xs:12,md:3,children:(0,N.jsxs)(y.Z,{variant:"body1",sx:{overflowX:"scroll"},children:["时间：",el.is_range_date?"".concat(es(el.dates[0]),"-").concat(es(el.dates[1])):el.dates.map(function(e){return es(e)}).join(",")]})}),(0,N.jsx)(p.ZP,{item:!0,xs:12,md:3,children:(0,N.jsxs)(b.Z,{direction:"row",alignItems:"center",children:[(0,N.jsx)(y.Z,{variant:"body1",children:"标签："}),(0,N.jsx)(b.Z,{direction:"row",spacing:1,alignItems:"center",sx:{flex:1,overflowX:"scroll"},children:(0,N.jsx)(O.Z,{tags:Array.from(eZ.values())})})]})}),(0,N.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,N.jsxs)(b.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,N.jsx)(y.Z,{variant:"body1",children:"选择来源："}),(0,N.jsx)(b.Z,{direction:"row",spacing:1,sx:{flex:1,overflowX:"scroll"},children:_.current.map(function(e){return(0,N.jsx)(g.Z,{label:e.name,variant:J===e.id?"filled":"outlined",color:J===e.id?"primary":"default",onClick:function(t){G(e.id)}},e.id)})}),(0,N.jsx)(v.Z,{variant:"outlined","aria-controls":K?"basic-menu":void 0,"aria-haspopup":"true",size:"small","aria-expanded":K?"true":void 0,onClick:function(e){return D(e.currentTarget)},children:"对比"}),(0,N.jsxs)(f.Z,{id:"basic-menu",anchorEl:M,open:K,onClose:function(){return D(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:[(0,N.jsx)(j.Z,{onClick:function(){U(ec.origin),D(null)},children:"对比原始文件"}),(0,N.jsx)(j.Z,{onClick:function(){U(ec.originProofread),D(null)},children:"对比原始文件并校对"}),(0,N.jsx)(j.Z,{onClick:function(){X(1===_.current.length?_.current[0].id:_.current.find(function(e){return e.id!==et.id}).id),U(ec.version),D(null)},children:"对比不同来源解析后的文本"}),(0,N.jsx)(j.Z,{onClick:function(){var e=prompt("导入代码")||"";e=(e=e.replace(/^\{OCR补丁\}/,"")).substr(0,e.lastIndexOf("}")+1);try{var t=JSON.parse(e);Q(t.publicationId,t.patch),X(ei),G(t.publicationId),U(ec.version),D(null)}catch(e){alert("解析错误")}},children:"导入代码对比OCR校对结果"}),(0,N.jsx)(j.Z,{onClick:function(){U(ec.none),D(null)},children:"取消"})]})]})})]});return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(b.Z,{sx:{height:"100%",boxSizing:"border-box",background:"white",zIndex:1,top:0,left:0},pb:0,children:[(0,N.jsxs)(p.ZP,{container:!0,alignItems:"center",sx:{pt:2,pl:2,pr:2},spacing:2,children:[(0,N.jsx)(p.ZP,{item:!0,xs:10,md:6,children:(0,N.jsxs)(y.Z,{variant:"body1",sx:{overflowX:"scroll"},children:["标题：",el.title,eu.length?"(别名:".concat(eu.join(","),")"):""]})}),(0,N.jsx)(p.ZP,{item:!0,xs:2,sx:{display:{md:"none",xs:"flex"}},children:(0,N.jsx)(v.Z,{onClick:function(){return B(!I)},children:I?"隐藏":"展开"})}),I?ew:null]}),(0,N.jsx)(b.Z,{direction:"row",divider:(0,N.jsx)(Z.Z,{orientation:"vertical",flexItem:!0}),spacing:2,sx:{flex:1,overflow:"auto",p:2},children:ey})]}),(0,N.jsx)(u(),{children:(0,N.jsxs)("title",{children:[el.title," - 和谐历史档案馆 Banned Historical Archives"]})})]})}eu.getLayout=function(e){return(0,N.jsx)(_.Z,{children:e})}},7380:function(e,t,n){"use strict";n.d(t,{Qy:function(){return c},zc:function(){return o}});var r,i,c=((r={}).articleCategory="文稿大类",r.articleType="文稿类型",r.place="地点",r.character="人物",r.issuer="出版方/发行方",r.subject="主题/事件",r.recorder="记录",r.reviewer="审核",r.translator="翻译",r.reprint="翻印/传抄",r),o=((i={}).appellation="appellation",i.title="title",i.authors="authors",i.place="place",i.subtitle="subtitle",i.subtitle2="subtitle2",i.subtitle3="subtitle3",i.subtitle4="subtitle4",i.subtitle5="subtitle5",i.subdate="subdate",i.paragraph="paragraph",i.quotation="quotation",i.signature="signature",i.image="image",i.image_description="image_description",i)},5281:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/articles/[id]",function(){return n(2161)}])},4601:function(){},2767:function(){},8251:function(){},7677:function(){},7324:function(){}},function(e){e.O(0,[714,824,738,771,916,27,379,794,634,335,774,888,179],function(){return e(e.s=5281)}),_N_E=e.O()}]);