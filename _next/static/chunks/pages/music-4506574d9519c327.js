(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[621],{2466:function(n,e,t){"use strict";t.d(e,{Z:function(){return s}});var i=t(5861),r=t(5893);function s(n){var e=n.diff;return e?(0,r.jsx)(r.Fragment,{children:e.map(function(n,e){return(0,r.jsx)(i.Z,{variant:"body1",sx:{margin:.5},children:n.map(function(n,e){return(0,r.jsx)("span",{style:{color:1===n[0]?"green":-1===n[0]?"red":"inherit"},children:n[1]},e)})},e)})}):null}},2846:function(n,e,t){"use strict";t.d(e,{Z:function(){return R}});var i=t(6447),r=t(7294),s=t(8307),o=t(948),a=t(1796),l=t(8462),c=t(7212),u=t(8619),d=t(9334),h=t(8780),x=t(326),f=t(2293),p=t(7357),m=t(7533),v=t(155),g=t(5861),j=t(3156),Z=t(1057),y=t(7241),b=t(1163),w=t(5449),k=t(787),C=t(3946),P=t(2761),_=t(5893),S=(0,o.ZP)("div")(function(n){var e=n.theme;return(0,s.Z)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:(0,a.Fq)(e.palette.common.white,.15),"&:hover":{backgroundColor:(0,a.Fq)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{marginLeft:e.spacing(3),width:"auto"})}),I=(0,o.ZP)("div")(function(n){return{padding:n.theme.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"}}),M=(0,o.ZP)(k.ZP)(function(n){var e=n.theme;return{color:"inherit","& .MuiInputBase-input":(0,s.Z)({padding:e.spacing(1,1,1,0),paddingLeft:"calc(1em + ".concat(e.spacing(4),")"),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{width:"20ch"})}}),E=[{name:"首页",path:"/"},{name:"文稿",path:"/articles"},{name:"音乐",path:"/music"},{name:"图库",path:"/gallery"}];function T(){var n=(0,b.useRouter)(),e=(0,r.useState)(""),t=e[0],s=e[1],o=(0,r.useState)(!1),a=o[0],k=o[1],T=function(){k(!a)},F=(0,_.jsx)(p.Z,{onClick:T,sx:{textAlign:"center"},children:(0,_.jsx)(l.Z,{children:E.map(function(n){return(0,_.jsx)(c.ZP,{disablePadding:!0,children:(0,_.jsx)(u.Z,{sx:{textAlign:"center"},href:n.path,target:"_blank",children:(0,_.jsx)(d.Z,{primary:n.name})})},n.name)})})});return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(f.Z,{position:"static",children:(0,_.jsx)(j.Z,{maxWidth:"xl",children:(0,_.jsxs)(v.Z,{disableGutters:!0,children:[(0,_.jsxs)(i.Z,{sx:{position:"relative",ml:1,transform:"translateY(4px)"},children:[(0,_.jsx)(h.Z,{sx:{width:20,position:"absolute",bottom:"50%",left:"50%",transform:"translateX(-50%)"}}),(0,_.jsx)(y.Z,{})]}),(0,_.jsx)(g.Z,{variant:"h6",noWrap:!0,component:"a",sx:{ml:1,mr:2,fontWeight:700,letterSpacing:".3rem",textDecoration:"none",cursor:"pointer"},style:{color:"white"},href:"/",onClick:function(){return n.push("/")},children:"和谐历史档案馆"}),(0,_.jsxs)(S,{sx:{display:{xs:"none",sm:"none",md:"flex",lg:"flex",xl:"flex"}},children:[(0,_.jsx)(I,{children:(0,_.jsx)(P.Z,{})}),(0,_.jsx)(M,{placeholder:"全站搜索",onKeyDown:function(e){if("Enter"===e.key){if("localhost"===location.hostname){n.push({pathname:"/search/[keyword]",query:{keyword:t}});return}window.open("https://www.google.com/search?q="+encodeURIComponent("site:banned-historical-archives.github.io "+t),"_blank")}},value:t,onChange:function(n){return s(n.target.value)},inputProps:{"aria-label":"search"}})]}),(0,_.jsx)(i.Z,{sx:{flex:1}}),(0,_.jsxs)(i.Z,{sx:{display:{xs:"none",sm:"flex"}},direction:"row",justifyContent:"flex-end",children:[E.map(function(e){var t=e.name,i=e.path;return(0,_.jsx)(Z.Z,{sx:{color:"white"},onClick:function(){return n.push(i)},children:t},i)}),(0,_.jsxs)(Z.Z,{href:"https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues",target:"_blank",sx:{color:"white"},children:[(0,_.jsx)(w.Z,{sx:{mr:1}}),"讨论"]})]}),(0,_.jsx)(C.Z,{size:"small",edge:"start",color:"inherit","aria-label":"menu",sx:{display:{xs:"flex",sm:"none"}},onClick:T,children:(0,_.jsx)(x.Z,{})})]})})}),(0,_.jsx)(p.Z,{component:"nav",children:(0,_.jsx)(m.ZP,{variant:"temporary",anchor:"right",open:a,onClose:T,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240}},children:F})})]})}function F(){return null}var N=t(8078);function R(n){var e=n.children,t=(0,r.useState)(!1),s=t[0],o=t[1],a=(0,b.useRouter)();return(0,r.useEffect)(function(){var n=function(n){o(!0)},e=function(){o(!1)};return a.events.on("routeChangeStart",n),a.events.on("routeChangeComplete",e),a.events.on("routeChangeError",e),function(){a.events.off("routeChangeStart",n),a.events.off("routeChangeComplete",e),a.events.off("routeChangeError",e)}},[a]),(0,_.jsx)(_.Fragment,{children:(0,_.jsxs)(i.Z,{sx:{position:"absolute",height:"100%",width:"100%"},direction:"column",children:[(0,_.jsx)(T,{}),s?(0,_.jsxs)(i.Z,{spacing:1,p:2,children:[(0,_.jsx)(N.Z,{variant:"text",sx:{fontSize:"1rem"}}),(0,_.jsx)(N.Z,{variant:"rectangular",height:60}),(0,_.jsx)(N.Z,{variant:"rectangular",height:60}),(0,_.jsx)(N.Z,{variant:"rectangular",height:60}),(0,_.jsx)(N.Z,{variant:"rectangular",height:60})]}):(0,_.jsx)("main",{style:{flex:1,position:"relative",overflow:"hidden"},children:e}),(0,_.jsx)(F,{})]})})}},809:function(n,e,t){"use strict";t.r(e),t.d(e,{__N_SSG:function(){return L},default:function(){return q}});var i,r=t(29),s=t(4687),o=t.n(s),a=t(7294),l=t(9008),c=t.n(l),u=t(2027),d=t(5397),h=t(6522),x=t(2846),f=t(1236),p=t(6426),m=t(8055),v=t(7357),g=t(6323),j=t(629),Z=t(8075),y=t(8360),b=t(1057),w=t(431),k=t(7720),C=t(6447),P=t(2280),_=t(8895),S=t(2797),I=t(5861),M=t(7349),E=t(3508),T=t(2466),F=t(5893);function N(n){var e=n.idx,t=n.setPlaying,i=n.setPlayingMusicIndex,r=n.setPlayingLyricIndex,s=n.setPlayingFileIndex,o=n.musicIndex,l=n.details,c=n.musicIndexes,d=(0,a.useState)(0),x=d[0],f=d[1],p=(0,a.useState)(0),m=p[0],v=p[1],g=(0,a.useMemo)(function(){var n;return null===(n=(null==l?void 0:l.lyrics[x])||(null==l?void 0:l.lyrics[0]))||void 0===n?void 0:n.content.split("\n")},[x,l]),j=(0,a.useMemo)(function(){var n;return null===(n=(null==l?void 0:l.lyrics[m])||(null==l?void 0:l.lyrics[0]))||void 0===n?void 0:n.content.split("\n")},[m,l]),Z=(0,a.useMemo)(function(){if(!l)return[];for(var n=(null==l?void 0:l.lyrics[x])||(null==l?void 0:l.lyrics[0]),e=(null==l?void 0:l.lyrics[m])||(null==l?void 0:l.lyrics[0]),t=n.content.split("\n"),i=e.content.split("\n"),r=0,s=Math.max(t.length,i.length),o=[];r<s;){var a=t[r]||"",c=i[r]||"";o.push(new u.diff_match_patch().diff_main(a,c)),++r}return o},[o,x,m,l]),M=l&&(null==l?void 0:l.id)===c[e][0]?(0,F.jsxs)(S.Z,{children:[(0,F.jsx)(k.Z,{}),(0,F.jsx)(I.Z,{variant:"subtitle1",sx:{mt:2,mb:2},children:"演唱/演奏版本："}),(0,F.jsx)(C.Z,{children:l.lyrics.map(function(n,e){return(0,F.jsx)(C.Z,{sx:{display:"inline"},children:n.audios.map(function(i,o){var a="".concat(null==l?void 0:l.name,"-").concat(n.version,"-").concat(i.artist||"未知");return(0,F.jsx)(b.Z,{sx:{justifyContent:"start"},startIcon:(0,F.jsx)(h.Z,{}),onClick:function(){r(e),s(0),t(!0)},children:a},e+"-"+o)})},e)})}),(0,F.jsx)(k.Z,{sx:{mt:2}}),l.lyrics.length>1?(0,F.jsx)(I.Z,{variant:"subtitle1",sx:{mt:2,mb:2},children:"歌词对比："}):null,(0,F.jsxs)(C.Z,{direction:"row",spacing:2,children:[(0,F.jsxs)(C.Z,{sx:{flex:1},children:[(0,F.jsx)(y.Z,{size:"small",value:null!=l&&l.lyrics[x]?x:0,label:"版本",sx:{mb:1},onChange:function(n){f(parseInt(n.target.value))},children:null==l?void 0:l.lyrics.map(function(n,e){return(0,F.jsx)(w.Z,{value:e,children:n.version},e)})}),(0,F.jsx)(C.Z,{children:null==g?void 0:g.map(function(n,e){return(0,F.jsx)(I.Z,{children:n},e)})})]}),l.lyrics.length>1?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(C.Z,{sx:{flex:1},children:[(0,F.jsx)(y.Z,{size:"small",value:null!=l&&l.lyrics[m]?m:0,label:"版本",sx:{mb:1},onChange:function(n){v(parseInt(n.target.value))},children:l.lyrics.map(function(n,e){return(0,F.jsx)(w.Z,{value:e,children:n.version},e)})}),(0,F.jsx)(C.Z,{children:null==j?void 0:j.map(function(n,e){return(0,F.jsx)(I.Z,{children:n},e)})})]}),(0,F.jsx)(C.Z,{sx:{flex:1},children:(0,F.jsx)(C.Z,{children:(0,F.jsx)(T.Z,{diff:Z})})})]}):null]})]}):(0,F.jsx)(F.Fragment,{});return(0,F.jsxs)(P.Z,{expanded:c[e][0]==(null==l?void 0:l.id),disableGutters:!0,onChange:function(n,t){t&&(i(e),r(0),s(0),setTimeout(function(){location.href="#"+e},100))},children:[(0,F.jsx)(_.Z,{expandIcon:(0,F.jsx)(E.Z,{}),id:e.toString(),children:(0,F.jsx)(I.Z,{variant:"h6",children:c[e][1]})}),M]})}var R=((i=R||{})[i.all=0]="all",i[i.shuffle=1]="shuffle",i[i.one=2]="one",i);function z(n){var e=n.playing,t=n.playingName,i=n.playNext,r=n.repeatType,s=n.setPlaying,o=n.setRepeatType;return(0,F.jsx)(F.Fragment,{children:(0,F.jsxs)(v.Z,{sx:{bottom:30,right:30,height:320,position:"fixed",transform:"translateZ(0px)",flexGrow:1,zIndex:20},children:[(0,F.jsx)(j.Z,{sx:{p:2,pt:1,pb:1,pr:4,mr:-2,position:"absolute",bottom:44,transform:"translateY(50%)",zIndex:10,right:70},children:(0,F.jsx)(I.Z,{sx:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",width:{xs:"200px",sm:"auto"}},children:t})}),(0,F.jsxs)(g.Z,{ariaLabel:"player",sx:{position:"absolute",bottom:16,right:16},onClick:function(){return s(!e)},icon:e?(0,F.jsx)(M.Z,{}):(0,F.jsx)(h.Z,{}),children:[(0,F.jsx)(Z.Z,{icon:(0,F.jsx)(d.Z,{}),onClick:function(n){n.stopPropagation(),i()},tooltipTitle:"下一首"}),(0,F.jsx)(Z.Z,{icon:(0,F.jsx)(m.Z,{sx:{color:r===R.shuffle?"#cc0000":"inherit"}}),onClick:function(n){n.stopPropagation(),o(R.shuffle)},tooltipTitle:"随机播放"}),(0,F.jsx)(Z.Z,{icon:(0,F.jsx)(p.Z,{sx:{color:r===R.all?"#cc0000":"inherit"}}),onClick:function(n){n.stopPropagation(),o(R.all)},tooltipTitle:"顺序播放"}),(0,F.jsx)(Z.Z,{icon:(0,F.jsx)(f.Z,{sx:{color:r===R.one?"#cc0000":"inherit"}}),onClick:function(n){n.stopPropagation(),o(R.one)},tooltipTitle:"单曲循环"})]})]})})}var L=!0;function q(n){var e,t,i,s=n.music,l=(0,a.useState)(!1),u=l[0],d=l[1],h=(0,a.useState)(R.shuffle),x=h[0],f=h[1],p=(0,a.useState)(),m=p[0],v=p[1],g=(0,a.useState)(0),j=g[0],Z=g[1],y=(0,a.useState)(0),b=y[0],w=y[1],k=(0,a.useState)(0),P=k[0],_=k[1],S=(0,a.useRef)(null),M=(0,a.useCallback)((e=(0,r.Z)(o().mark(function n(e,t){var i,r;return o().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i="https://raw.githubusercontent.com/banned-historical-archives/banned-historical-archives".concat(t,"/parsed/").concat(e.substr(0,3),"/").concat(e,"/").concat(e,".metadata"),n.next=3,fetch(i);case 3:return n.next=5,n.sent.json();case 5:return r=n.sent,n.abrupt("return",r);case 7:case"end":return n.stop()}},n)})),function(n,t){return e.apply(this,arguments)}),[]);(0,a.useEffect)(function(){M(s[j][0],s[j][2]).then(function(n){v(n),w(0),_(0)})},[j]),(0,a.useEffect)(function(){S.current&&(u?S.current.play().catch(function(){}):S.current.pause())},[u]),(0,a.useEffect)(function(){if(S.current&&u){var n=null==m?void 0:m.lyrics[b];n&&n.audios[P]&&(S.current.src=n.audios[P].url,S.current.play().catch(function(){}))}},[m,u,P,b]);var E=(0,a.useCallback)((0,r.Z)(o().mark(function n(){var e,t,i,r;return o().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(x!==R.one){n.next=4;break}S.current.play().catch(function(){}),n.next=21;break;case 4:if(x!==R.all){n.next=9;break}m.lyrics[b].audios[P+1]?_(P+1):m.lyrics[b+1]?(w(b+1),_(0)):s[j+1]?(Z(j+1),w(0),_(0),setTimeout(function(){location.href="#"+(j+1)},100)):(Z(0),w(0),_(0),setTimeout(function(){location.href="#0"},100)),n.next=21;break;case 9:if(x!==R.shuffle){n.next=21;break}return e=Math.floor(Math.random()*s.length),t=s[e],Z(e),n.next=15,M(t[0],t[2]);case 15:v(i=n.sent),w(r=Math.floor(i.lyrics.length*Math.random())),_(Math.floor(i.lyrics[r].audios.length*Math.random())),setTimeout(function(){location.href="#"+e},100);case 21:case"end":return n.stop()}},n)})),[m,j,P,b,x]);return(0,F.jsxs)(C.Z,{p:2,sx:{height:"100%",overflow:"scroll"},children:[(0,F.jsx)(c(),{children:(0,F.jsx)("title",{children:"和谐历史档案馆 Banned Historical Archives"})}),(0,F.jsx)(I.Z,{variant:"h4",sx:{mb:1},children:"音乐"}),(0,F.jsx)(I.Z,{variant:"body1",sx:{mb:1},children:"多媒体资料包括音乐及歌词、电影、照片、录音等。目前主要收录社会主义中国创作的红色音乐。"}),(0,F.jsx)("audio",{ref:S,onEnded:function(){E()},src:null==m?void 0:m.lyrics[b].audios[P].url,style:{position:"fixed",left:"100%"}}),(0,F.jsx)(z,{playing:u,playNext:E,repeatType:x,playingName:"".concat(null==m?void 0:m.name,"-").concat(null==m||null===(t=m.lyrics[b])||void 0===t?void 0:t.version,"-").concat((null==m||null===(i=m.lyrics[b])||void 0===i||null===(i=i.audios[P])||void 0===i?void 0:i.artist)||"未知"),setRepeatType:f,setPlaying:d}),s.map(function(n,e){return(0,F.jsx)(N,{musicIndex:j,idx:e,details:s[j][0]===(null==m?void 0:m.id)?m:void 0,setPlaying:d,setPlayingLyricIndex:w,setPlayingMusicIndex:Z,setPlayingFileIndex:_,musicIndexes:s},e)})]})}q.getLayout=function(n){return(0,F.jsx)(x.Z,{children:n})}},2095:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/music",function(){return t(809)}])}},function(n){n.O(0,[738,771,386,27,164,774,888,179],function(){return n(n.s=2095)}),_N_E=n.O()}]);