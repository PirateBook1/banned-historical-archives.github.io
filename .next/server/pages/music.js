(()=>{var e={};e.id=621,e.ids=[621,660],e.modules={2466:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var i=r(7163),s=r.n(i),n=r(997);function a({diff:e}){return e?n.jsx(n.Fragment,{children:e.map((e,t)=>n.jsx(s(),{variant:"body1",sx:{margin:.5},children:e.map((e,t)=>n.jsx("span",{style:{color:1===e[0]?"green":-1===e[0]?"red":"inherit"},children:e[1]},t))},t))}):null}},2846:(e,t,r)=>{"use strict";r.d(t,{Z:()=>Q});var i=r(8742),s=r.n(i),n=r(6689),a=r(8442),l=r(4192),o=r.n(l),c=r(834),u=r.n(c),x=r(1011),m=r.n(x),p=r(8315),h=r.n(p),d=r(1914),g=r.n(d),f=r(3365),j=r.n(f),v=r(3882),y=r.n(v),b=r(19),q=r.n(b),S=r(7898),w=r.n(S),C=r(1431),P=r.n(C),k=r(7163),M=r.n(k),I=r(4475),_=r.n(I),T=r(3819),E=r.n(T),L=r(4789),$=r.n(L),A=r(1163),B=r(9254),R=r.n(B),D=r(8855),F=r.n(D),z=r(7934),G=r.n(z),N=r(8017),W=r.n(N),Z=r(997);let O=(0,a.styled)("div")(({theme:e})=>({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:(0,a.alpha)(e.palette.common.white,.15),"&:hover":{backgroundColor:(0,a.alpha)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:0,width:"100%",[e.breakpoints.up("sm")]:{marginLeft:e.spacing(3),width:"auto"}})),H=(0,a.styled)("div")(({theme:e})=>({padding:e.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"})),V=(0,a.styled)(F())(({theme:e})=>({color:"inherit","& .MuiInputBase-input":{padding:e.spacing(1,1,1,0),paddingLeft:`calc(1em + ${e.spacing(4)})`,transition:e.transitions.create("width"),width:"100%",[e.breakpoints.up("md")]:{width:"20ch"}}})),X=[{name:"首页",path:"/"},{name:"文稿",path:"/articles"},{name:"音乐",path:"/music"},{name:"图库",path:"/gallery"}];function Y(){let e=(0,A.useRouter)(),{0:t,1:r}=(0,n.useState)(""),{0:i,1:a}=(0,n.useState)(!1),l=()=>{a(!i)},c=Z.jsx(q(),{onClick:l,sx:{textAlign:"center"},children:Z.jsx(o(),{children:X.map(e=>Z.jsx(u(),{disablePadding:!0,children:Z.jsx(m(),{sx:{textAlign:"center"},href:e.path,target:"_blank",children:Z.jsx(h(),{primary:e.name})})},e.name))})});return(0,Z.jsxs)(Z.Fragment,{children:[Z.jsx(y(),{position:"static",children:Z.jsx(_(),{maxWidth:"xl",children:(0,Z.jsxs)(P(),{disableGutters:!0,children:[(0,Z.jsxs)(s(),{sx:{position:"relative",ml:1,transform:"translateY(4px)"},children:[Z.jsx(g(),{sx:{width:20,position:"absolute",bottom:"50%",left:"50%",transform:"translateX(-50%)"}}),Z.jsx($(),{})]}),Z.jsx(M(),{variant:"h6",noWrap:!0,component:"a",sx:{ml:1,mr:2,fontWeight:700,letterSpacing:".3rem",textDecoration:"none",cursor:"pointer"},style:{color:"white"},href:"/",onClick:()=>e.push("/"),children:"和谐历史档案馆"}),(0,Z.jsxs)(O,{sx:{display:{xs:"none",sm:"none",md:"flex",lg:"flex",xl:"flex"}},children:[Z.jsx(H,{children:Z.jsx(W(),{})}),Z.jsx(V,{placeholder:"全站搜索",onKeyDown:r=>{if("Enter"===r.key){if("localhost"===location.hostname){e.push({pathname:"/search/[keyword]",query:{keyword:t}});return}window.open("https://www.google.com/search?q="+encodeURIComponent("site:banned-historical-archives.github.io "+t),"_blank")}},value:t,onChange:e=>r(e.target.value),inputProps:{"aria-label":"search"}})]}),Z.jsx(s(),{sx:{flex:1}}),(0,Z.jsxs)(s(),{sx:{display:{xs:"none",sm:"flex"}},direction:"row",justifyContent:"flex-end",children:[X.map(({name:t,path:r})=>Z.jsx(E(),{sx:{color:"white"},onClick:()=>e.push(r),children:t},r)),(0,Z.jsxs)(E(),{href:"https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues",target:"_blank",sx:{color:"white"},children:[Z.jsx(R(),{sx:{mr:1}}),"讨论"]})]}),Z.jsx(G(),{size:"small",edge:"start",color:"inherit","aria-label":"menu",sx:{display:{xs:"flex",sm:"none"}},onClick:l,children:Z.jsx(j(),{})})]})})}),Z.jsx(q(),{component:"nav",children:Z.jsx(w(),{variant:"temporary",anchor:"right",open:i,onClose:l,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240}},children:c})})]})}function J(){return null}var K=r(441),U=r.n(K);function Q({children:e}){let{0:t,1:r}=(0,n.useState)(!1),i=(0,A.useRouter)();return(0,n.useEffect)(()=>{let e=e=>{r(!0)},t=()=>{r(!1)};return i.events.on("routeChangeStart",e),i.events.on("routeChangeComplete",t),i.events.on("routeChangeError",t),()=>{i.events.off("routeChangeStart",e),i.events.off("routeChangeComplete",t),i.events.off("routeChangeError",t)}},[i]),Z.jsx(Z.Fragment,{children:(0,Z.jsxs)(s(),{sx:{position:"absolute",height:"100%",width:"100%"},direction:"column",children:[Z.jsx(Y,{}),t?(0,Z.jsxs)(s(),{spacing:1,p:2,children:[Z.jsx(U(),{variant:"text",sx:{fontSize:"1rem"}}),Z.jsx(U(),{variant:"rectangular",height:60}),Z.jsx(U(),{variant:"rectangular",height:60}),Z.jsx(U(),{variant:"rectangular",height:60}),Z.jsx(U(),{variant:"rectangular",height:60})]}):Z.jsx("main",{style:{flex:1,position:"relative",overflow:"hidden"},children:e}),Z.jsx(J,{})]})})}},1562:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a}),r(6764),r(968);var i=r(5152),s=r.n(i),n=r(8442);r(997),(0,n.createTheme)({palette:{primary:{main:"#cc0000"}},components:{}});let a=s()(async()=>null,{ssr:!1})},9839:(e,t,r)=>{"use strict";r.r(t),r.d(t,{config:()=>eh,default:()=>eu,getServerSideProps:()=>ep,getStaticPaths:()=>em,getStaticProps:()=>ex,reportWebVitals:()=>ed,routeModule:()=>eb,unstable_getServerProps:()=>ev,unstable_getServerSideProps:()=>ey,unstable_getStaticParams:()=>ej,unstable_getStaticPaths:()=>ef,unstable_getStaticProps:()=>eg});var i={};r.r(i),r.d(i,{default:()=>ec,getStaticProps:()=>en});var s=r(7093),n=r(5244),a=r(1323),l=r(1445),o=r.n(l),c=r(1562),u=r(6689),x=r(968),m=r.n(x),p=r(8066);let h=require("@mui/icons-material/SkipNext");var d=r.n(h),g=r(8618),f=r.n(g),j=r(2846);let v=require("@mui/icons-material/RepeatOne");var y=r.n(v);let b=require("@mui/icons-material/FormatListNumbered");var q=r.n(b);let S=require("@mui/icons-material/Shuffle");var w=r.n(S),C=r(19),P=r.n(C);let k=require("@mui/material/SpeedDial");var M=r.n(k);let I=require("@mui/material/Paper");var _=r.n(I);let T=require("@mui/material/SpeedDialAction");var E=r.n(T),L=r(2651),$=r.n(L),A=r(3819),B=r.n(A),R=r(9271),D=r.n(R),F=r(3646),z=r.n(F),G=r(8742),N=r.n(G);let W=require("@mui/material/Accordion");var Z=r.n(W);let O=require("@mui/material/AccordionSummary");var H=r.n(O);let V=require("@mui/material/AccordionDetails");var X=r.n(V),Y=r(7163),J=r.n(Y),K=r(2544),U=r.n(K);let Q=require("@mui/icons-material/ExpandMore");var ee=r.n(Q),et=r(2466),er=r(4470),ei=r(4822),es=r(997);let en=async e=>({props:{music:JSON.parse((await (0,er.readFile)((0,ei.join)(process.cwd(),"./music_indexes.json"))).toString())}});function ea({idx:e,setPlaying:t,setPlayingMusicIndex:r,setPlayingLyricIndex:i,setPlayingFileIndex:s,musicIndex:n,details:a,musicIndexes:l}){let{0:o,1:c}=(0,u.useState)(0),{0:x,1:m}=(0,u.useState)(0),h=(0,u.useMemo)(()=>(a?.lyrics[o]||a?.lyrics[0])?.content.split("\n"),[o,a]),d=(0,u.useMemo)(()=>(a?.lyrics[x]||a?.lyrics[0])?.content.split("\n"),[x,a]),g=(0,u.useMemo)(()=>{if(!a)return[];let e=a?.lyrics[o]||a?.lyrics[0],t=a?.lyrics[x]||a?.lyrics[0],r=e.content.split("\n"),i=t.content.split("\n"),s=0,n=Math.max(r.length,i.length),l=[];for(;s<n;){let e=r[s]||"",t=i[s]||"";l.push(new p.diff_match_patch().diff_main(e,t)),++s}return l},[n,o,x,a]),j=a&&a?.id===l[e][0]?(0,es.jsxs)(X(),{children:[es.jsx(z(),{}),es.jsx(J(),{variant:"subtitle1",sx:{mt:2,mb:2},children:"演唱/演奏版本："}),es.jsx(N(),{children:a.lyrics.map((e,r)=>es.jsx(N(),{sx:{display:"inline"},children:e.audios.map((n,l)=>{let o=`${a?.name}-${e.version}-${n.artist||"未知"}`;return es.jsx(B(),{sx:{justifyContent:"start"},startIcon:es.jsx(f(),{}),onClick:()=>{i(r),s(0),t(!0)},children:o},r+"-"+l)})},r))}),es.jsx(z(),{sx:{mt:2}}),a.lyrics.length>1?es.jsx(J(),{variant:"subtitle1",sx:{mt:2,mb:2},children:"歌词对比："}):null,(0,es.jsxs)(N(),{direction:"row",spacing:2,children:[(0,es.jsxs)(N(),{sx:{flex:1},children:[es.jsx($(),{size:"small",value:a?.lyrics[o]?o:0,label:"版本",sx:{mb:1},onChange:e=>{c(parseInt(e.target.value))},children:a?.lyrics.map((e,t)=>es.jsx(D(),{value:t,children:e.version},t))}),es.jsx(N(),{children:h?.map((e,t)=>es.jsx(J(),{children:e},t))})]}),a.lyrics.length>1?(0,es.jsxs)(es.Fragment,{children:[(0,es.jsxs)(N(),{sx:{flex:1},children:[es.jsx($(),{size:"small",value:a?.lyrics[x]?x:0,label:"版本",sx:{mb:1},onChange:e=>{m(parseInt(e.target.value))},children:a.lyrics.map((e,t)=>es.jsx(D(),{value:t,children:e.version},t))}),es.jsx(N(),{children:d?.map((e,t)=>es.jsx(J(),{children:e},t))})]}),es.jsx(N(),{sx:{flex:1},children:es.jsx(N(),{children:es.jsx(et.Z,{diff:g})})})]}):null]})]}):es.jsx(es.Fragment,{});return(0,es.jsxs)(Z(),{expanded:l[e][0]==a?.id,disableGutters:!0,onChange:(t,n)=>{n&&(r(e),i(0),s(0),setTimeout(()=>{location.href="#"+e},100))},children:[es.jsx(H(),{expandIcon:es.jsx(ee(),{}),id:e.toString(),children:es.jsx(J(),{variant:"h6",children:l[e][1]})}),j]})}var el=function(e){return e[e.all=0]="all",e[e.shuffle=1]="shuffle",e[e.one=2]="one",e}(el||{});function eo({playing:e,playingName:t,playNext:r,repeatType:i,setPlaying:s,setRepeatType:n}){return es.jsx(es.Fragment,{children:(0,es.jsxs)(P(),{sx:{bottom:30,right:30,height:320,position:"fixed",transform:"translateZ(0px)",flexGrow:1,zIndex:20},children:[es.jsx(_(),{sx:{p:2,pt:1,pb:1,pr:4,mr:-2,position:"absolute",bottom:44,transform:"translateY(50%)",zIndex:10,right:70},children:es.jsx(J(),{sx:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",width:{xs:"200px",sm:"auto"}},children:t})}),(0,es.jsxs)(M(),{ariaLabel:"player",sx:{position:"absolute",bottom:16,right:16},onClick:()=>s(!e),icon:e?es.jsx(U(),{}):es.jsx(f(),{}),children:[es.jsx(E(),{icon:es.jsx(d(),{}),onClick:e=>{e.stopPropagation(),r()},tooltipTitle:"下一首"}),es.jsx(E(),{icon:es.jsx(w(),{sx:{color:i===el.shuffle?"#cc0000":"inherit"}}),onClick:e=>{e.stopPropagation(),n(el.shuffle)},tooltipTitle:"随机播放"}),es.jsx(E(),{icon:es.jsx(q(),{sx:{color:i===el.all?"#cc0000":"inherit"}}),onClick:e=>{e.stopPropagation(),n(el.all)},tooltipTitle:"顺序播放"}),es.jsx(E(),{icon:es.jsx(y(),{sx:{color:i===el.one?"#cc0000":"inherit"}}),onClick:e=>{e.stopPropagation(),n(el.one)},tooltipTitle:"单曲循环"})]})]})})}function ec({music:e}){let{0:t,1:r}=(0,u.useState)(!1),{0:i,1:s}=(0,u.useState)(el.shuffle),{0:n,1:a}=(0,u.useState)(),{0:l,1:o}=(0,u.useState)(0),{0:c,1:x}=(0,u.useState)(0),{0:p,1:h}=(0,u.useState)(0),d=(0,u.useRef)(null),g=(0,u.useCallback)(async(e,t)=>{let r=`https://raw.githubusercontent.com/banned-historical-archives/banned-historical-archives${t}/parsed/${e.substr(0,3)}/${e}/${e}.metadata`;return await (await fetch(r)).json()},[]);(0,u.useEffect)(()=>{g(e[l][0],e[l][2]).then(e=>{a(e),x(0),h(0)})},[l]),(0,u.useEffect)(()=>{d.current&&(t?d.current.play().catch(()=>{}):d.current.pause())},[t]),(0,u.useEffect)(()=>{if(!d.current||!t)return;let e=n?.lyrics[c];e&&e.audios[p]&&(d.current.src=e.audios[p].url,d.current.play().catch(()=>{}))},[n,t,p,c]);let f=(0,u.useCallback)(async()=>{if(i===el.one)d.current.play().catch(()=>{});else if(i===el.all)n.lyrics[c].audios[p+1]?h(p+1):n.lyrics[c+1]?(x(c+1),h(0)):e[l+1]?(o(l+1),x(0),h(0),setTimeout(()=>{location.href="#"+(l+1)},100)):(o(0),x(0),h(0),setTimeout(()=>{location.href="#0"},100));else if(i===el.shuffle){let t=Math.floor(Math.random()*e.length),r=e[t];o(t);let i=await g(r[0],r[2]);a(i);let s=Math.floor(i.lyrics.length*Math.random());x(s),h(Math.floor(i.lyrics[s].audios.length*Math.random())),setTimeout(()=>{location.href="#"+t},100)}},[n,l,p,c,i]);return(0,es.jsxs)(N(),{p:2,sx:{height:"100%",overflow:"scroll"},children:[es.jsx(m(),{children:es.jsx("title",{children:"和谐历史档案馆 Banned Historical Archives"})}),es.jsx(J(),{variant:"h4",sx:{mb:1},children:"音乐"}),es.jsx(J(),{variant:"body1",sx:{mb:1},children:"多媒体资料包括音乐及歌词、电影、照片、录音等。目前主要收录社会主义中国创作的红色音乐。"}),es.jsx("audio",{ref:d,onEnded:()=>{f()},src:n?.lyrics[c].audios[p].url,style:{position:"fixed",left:"100%"}}),es.jsx(eo,{playing:t,playNext:f,repeatType:i,playingName:`${n?.name}-${n?.lyrics[c]?.version}-${n?.lyrics[c]?.audios[p]?.artist||"未知"}`,setRepeatType:s,setPlaying:r}),e.map((t,i)=>es.jsx(ea,{musicIndex:l,idx:i,details:e[l][0]===n?.id?n:void 0,setPlaying:r,setPlayingLyricIndex:x,setPlayingMusicIndex:o,setPlayingFileIndex:h,musicIndexes:e},i))]})}ec.getLayout=e=>es.jsx(j.Z,{children:e});let eu=(0,a.l)(i,"default"),ex=(0,a.l)(i,"getStaticProps"),em=(0,a.l)(i,"getStaticPaths"),ep=(0,a.l)(i,"getServerSideProps"),eh=(0,a.l)(i,"config"),ed=(0,a.l)(i,"reportWebVitals"),eg=(0,a.l)(i,"unstable_getStaticProps"),ef=(0,a.l)(i,"unstable_getStaticPaths"),ej=(0,a.l)(i,"unstable_getStaticParams"),ev=(0,a.l)(i,"unstable_getServerProps"),ey=(0,a.l)(i,"unstable_getServerSideProps"),eb=new s.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/music",pathname:"/music",bundlePath:"",filename:""},components:{App:c.default,Document:o()},userland:i})},6764:()=>{},1914:e=>{"use strict";e.exports=require("@mui/icons-material/Block")},9254:e=>{"use strict";e.exports=require("@mui/icons-material/GitHub")},3365:e=>{"use strict";e.exports=require("@mui/icons-material/Menu")},4789:e=>{"use strict";e.exports=require("@mui/icons-material/MenuBook")},2544:e=>{"use strict";e.exports=require("@mui/icons-material/PauseCircle")},8618:e=>{"use strict";e.exports=require("@mui/icons-material/PlayCircle")},8017:e=>{"use strict";e.exports=require("@mui/icons-material/Search")},3882:e=>{"use strict";e.exports=require("@mui/material/AppBar")},19:e=>{"use strict";e.exports=require("@mui/material/Box")},3819:e=>{"use strict";e.exports=require("@mui/material/Button")},4475:e=>{"use strict";e.exports=require("@mui/material/Container")},3646:e=>{"use strict";e.exports=require("@mui/material/Divider")},7898:e=>{"use strict";e.exports=require("@mui/material/Drawer")},7934:e=>{"use strict";e.exports=require("@mui/material/IconButton")},8855:e=>{"use strict";e.exports=require("@mui/material/InputBase")},4192:e=>{"use strict";e.exports=require("@mui/material/List")},834:e=>{"use strict";e.exports=require("@mui/material/ListItem")},1011:e=>{"use strict";e.exports=require("@mui/material/ListItemButton")},8315:e=>{"use strict";e.exports=require("@mui/material/ListItemText")},9271:e=>{"use strict";e.exports=require("@mui/material/MenuItem")},2651:e=>{"use strict";e.exports=require("@mui/material/Select")},441:e=>{"use strict";e.exports=require("@mui/material/Skeleton")},8742:e=>{"use strict";e.exports=require("@mui/material/Stack")},1431:e=>{"use strict";e.exports=require("@mui/material/Toolbar")},7163:e=>{"use strict";e.exports=require("@mui/material/Typography")},8442:e=>{"use strict";e.exports=require("@mui/material/styles")},8066:e=>{"use strict";e.exports=require("diff-match-patch")},4470:e=>{"use strict";e.exports=require("fs-extra")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},7147:e=>{"use strict";e.exports=require("fs")},4822:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},9796:e=>{"use strict";e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[445,1],()=>r(9839));module.exports=i})();