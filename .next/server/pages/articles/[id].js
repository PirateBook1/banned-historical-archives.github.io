"use strict";(()=>{var e={};e.id=977,e.ids=[977,660],e.modules={8193:(e,t,r)=>{r.d(t,{Z:()=>d});var i=r(5692),n=r(8066),s=r(6689),a=r(997);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){var i,n;i=t,n=r[t],(i=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e){let t=o(o({},e),{},{insertBefore:e.insertBefore.map(e=>({text:e.text})),insertAfter:e.insertAfter.map(e=>({text:e.text}))});return t.insertBefore.length||delete t.insertBefore,t.insertAfter.length||delete t.insertAfter,t}function u(e){let{onClose:t}=e,{0:r,1:n}=(0,s.useState)("");return(0,a.jsxs)(i.Dialog,{onClose:()=>t(),open:!0,children:[a.jsx(i.DialogTitle,{children:"插入"}),(0,a.jsxs)(i.Stack,{spacing:2,p:2,children:[a.jsx(i.TextField,{size:"small",value:r,onChange:e=>n(e.target.value),multiline:!0,autoFocus:!0}),(0,a.jsxs)(i.ButtonGroup,{children:[a.jsx(i.Button,{onClick:()=>t(r),children:"确定"}),a.jsx(i.Button,{onClick:()=>t(),children:"取消"})]})]})]})}function d({content:e,onChange:t}){let{0:r,1:l}=(0,s.useState)(!1),{0:d,1:p}=(0,s.useState)(!1),{0:x,1:h}=(0,s.useState)([]),{0:m,1:f}=(0,s.useState)([]),{0:g,1:j}=(0,s.useState)(!e),b=(0,s.useRef)({insertBefore:[],insertAfter:[]}),{0:y,1:v}=(0,s.useState)(e),S=(0,a.jsxs)(i.Stack,{direction:"row",sx:{mt:1,mb:1},spacing:1,children:[a.jsx(i.TextField,{sx:{flex:1},size:"small",onChange:r=>{let i=o({},b.current);if(r.target.value.length){delete i.delete,j(!1);let t=new n.diff_match_patch().diff_main(e,r.target.value);e?1!==t.length?i.diff=new n.diff_match_patch().diff_toDelta(t):delete i.diff:i.diff=new n.diff_match_patch().diff_toDelta(t)}else i.delete=!0,j(!0);b.current=i,t(c(i)),v(r.target.value)},value:y,multiline:!0}),(0,a.jsxs)(i.Stack,{spacing:1,children:[a.jsx(i.Button,{size:"small",variant:"outlined",onClick:()=>l(!0),children:"上方插入"}),a.jsx(i.Button,{size:"small",variant:"outlined",onClick:()=>p(!0),children:"下方插入"}),a.jsx(i.FormControlLabel,{control:a.jsx(i.Checkbox,{size:"small",checked:g,onChange:e=>{y.length&&(j(e.target.checked),b.current=o(o({},b.current),{},{delete:e.target.checked}),t(c(b.current)))}}),label:"删除"})]})]});return(0,a.jsxs)(a.Fragment,{children:[x.map(e=>a.jsx("li",{children:(0,a.jsxs)(i.Stack,{direction:"row",spacing:1,children:[a.jsx(i.TextField,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),a.jsx(i.Button,{variant:"outlined",size:"small",onClick:()=>{b.current.insertBefore=x.filter(t=>t.id!==e.id),h(b.current.insertBefore),t(c(b.current))},children:"删除"})]})},e.id)),r?a.jsx(u,{onClose:e=>{if(!e){l(!1);return}let r=[...x,{id:Math.random().toString(),text:e}];h(r),l(!1),b.current.insertBefore=r,t(c(b.current))}}):null,d?a.jsx(u,{onClose:e=>{if(!e){p(!1);return}let r=[...m,{id:Math.random().toString(),text:e}];f(r),p(!1),b.current.insertAfter=r,t(c(b.current))}}):null,g?S:a.jsx("li",{children:S},"center"),m.map(e=>a.jsx("li",{children:(0,a.jsxs)(i.Stack,{direction:"row",spacing:1,children:[a.jsx(i.TextField,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),a.jsx(i.Button,{variant:"outlined",size:"small",onClick:()=>{b.current.insertAfter=m.filter(t=>t.id!==e.id),f(b.current.insertAfter),t(c(b.current))},children:"删除"})]})},e.id))]})}},8741:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{Z:()=>m});var n=r(5692),s=r(8066),a=r(6689),l=r(7380),o=r(5158),c=r(997),u=e([o]);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){var i,n;i=t,n=r[t],(i=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function x(e){let{onClose:t}=e,{0:r,1:i}=(0,a.useState)(""),{0:s,1:o}=(0,a.useState)(l.zc.paragraph);return(0,c.jsxs)(n.Dialog,{onClose:()=>t(),open:!0,children:[c.jsx(n.DialogTitle,{children:"插入段落"}),(0,c.jsxs)(n.Stack,{spacing:2,p:2,children:[c.jsx(n.TextField,{size:"small",value:r,onChange:e=>i(e.target.value),multiline:!0,autoFocus:!0}),c.jsx(n.Typography,{children:"类型："}),c.jsx(n.Select,{sx:{width:130},size:"small",defaultValue:s,onChange:e=>{o(e.target.value)},children:Object.keys(l.zc).map(e=>c.jsx(n.MenuItem,{value:e,children:e},e))}),(0,c.jsxs)(n.ButtonGroup,{children:[c.jsx(n.Button,{onClick:()=>t(s,r),children:"确定"}),c.jsx(n.Button,{onClick:()=>t(),children:"取消"})]})]})]})}function h(e){let t=p(p({},e),{},{insertBefore:e.insertBefore.map(e=>({type:e.type,text:e.text})),insertAfter:e.insertAfter.map(e=>({type:e.type,text:e.text}))});return t.insertBefore.length||delete t.insertBefore,t.insertAfter.length||delete t.insertAfter,t}function m({idx:e,content:t,comments:r,onChange:i}){let{0:u,1:d}=(0,a.useState)(!1),{0:m,1:f}=(0,a.useState)(!1),{0:g,1:j}=(0,a.useState)([]),{0:b,1:y}=(0,a.useState)([]),{0:v,1:S}=(0,a.useState)(!1),w=(0,a.useRef)({insertBefore:[],insertAfter:[]}),k=(0,a.useMemo)(()=>{let i=Array.from(t.text);return r.filter(t=>t.part_idx===e).sort((e,t)=>t.index-e.index).forEach(e=>i.splice(e.offset,0,`${o.oW}${e.index}${o.Pc}`)),i.join("")},[t,r,e]),{0:C,1:O}=(0,a.useState)(k);return(0,c.jsxs)(c.Fragment,{children:[g.map(e=>(0,c.jsxs)(n.Stack,{direction:"row",spacing:1,children:[c.jsx(n.TextField,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),c.jsx(n.Typography,{variant:"caption",children:e.type}),c.jsx(n.Button,{variant:"outlined",size:"small",onClick:()=>{w.current.insertBefore=g.filter(t=>t.id!==e.id),j(w.current.insertBefore),i(h(w.current))},children:"删除"})]},e.id)),u?c.jsx(x,{onClose:(e,t)=>{if(!e||!t)return;let r=[...g,{id:Math.random().toString(),type:e,text:t}];j(r),d(!1),w.current.insertBefore=r,i(h(w.current))}}):null,m?c.jsx(x,{onClose:(e,t)=>{if(!e||!t)return;let r=[...b,{id:Math.random().toString(),type:e,text:t}];y(r),f(!1),w.current.insertAfter=r,i(h(w.current))}}):null,(0,c.jsxs)(n.Stack,{direction:"row",sx:{mt:1,mb:1},spacing:1,children:[c.jsx(n.TextField,{sx:{flex:1},size:"small",onChange:e=>{let t=p({},w.current);if(e.target.value.length){delete t.delete,S(!1);let r=new s.diff_match_patch().diff_main(k,e.target.value);1===r.length&&k?delete t.diff:t.diff=new s.diff_match_patch().diff_toDelta(r)}else t.delete=!0,delete t.diff,S(!0);w.current=t,i(h(t)),O(e.target.value)},value:C,multiline:!0},t.id),(0,c.jsxs)(n.Stack,{spacing:1,children:[c.jsx(n.Select,{sx:{width:130},size:"small",defaultValue:t.type,onChange:e=>{w.current=p(p({},w.current),{},{type:e.target.value}),i(h(w.current))},children:Object.keys(l.zc).map(e=>c.jsx(n.MenuItem,{value:e,children:e},e))}),c.jsx(n.Button,{size:"small",variant:"outlined",onClick:()=>d(!0),children:"上方插入"}),c.jsx(n.Button,{size:"small",variant:"outlined",onClick:()=>f(!0),children:"下方插入"}),c.jsx(n.FormControlLabel,{control:c.jsx(n.Checkbox,{size:"small",checked:v,onChange:e=>{C.length&&(S(e.target.checked),w.current=p(p({},w.current),{},{delete:e.target.checked}),i(h(w.current)))}}),label:"删除"})]})]}),b.map(e=>(0,c.jsxs)(n.Stack,{direction:"row",spacing:1,children:[c.jsx(n.TextField,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),c.jsx(n.Typography,{variant:"caption",children:e.type}),c.jsx(n.Button,{variant:"outlined",size:"small",onClick:()=>{w.current.insertAfter=b.filter(t=>t.id!==e.id),y(w.current.insertAfter),i(h(w.current))},children:"删除"})]},e.id))]})}o=(u.then?(await u)():u)[0],i()}catch(e){i(e)}})},9047:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{Z:()=>d});var n=r(5692),s=r(8066),a=r(6689),l=r(8193),o=r(8741),c=r(997),u=e([o]);o=(u.then?(await u)():u)[0];let p=process.env.COMMIT_HASH;function d({contents:e,comments:t,description:r,article:i,articleId:u,publicationId:d,publicationName:x}){var h;let m=(0,a.useRef)({version:2,parts:{},comments:{},description:""}),{0:f,1:g}=(0,a.useState)(""),{0:j,1:b}=(0,a.useState)(null);return(0,c.jsxs)(c.Fragment,{children:[c.jsx(n.Stack,{sx:{mb:1},spacing:1,direction:"row",children:c.jsx(n.Button,{variant:"outlined",size:"small",onClick:()=>window.open("https://github.com/banned-historical-archives/banned-historical-archives.github.io/wiki/%E6%A0%87%E5%87%86%E5%8C%96%E6%96%87%E7%A8%BF%E5%BD%95%E5%85%A5%E4%B8%8E%E6%A0%A1%E5%AF%B9","_blank"),children:"校对注意事项"})}),c.jsx(n.Popover,{open:!!j,anchorEl:j,onClose:()=>b(null),children:c.jsx(n.TextField,{multiline:!0,value:f})}),e.map((e,r)=>c.jsx(o.Z,{onChange:t=>{t.diff||t.delete||t.type&&t.type!==e.type||t.insertAfter||t.insertBefore?m.current.parts[r]=t:delete m.current.parts[r]},idx:r,comments:t,content:e},e.id)),c.jsx(n.Divider,{sx:{mt:2,mb:2}}),c.jsx(n.Typography,{variant:"h6",sx:{mb:2},children:"描述"}),(h=t.find(e=>-1===e.index)||{index:-1,text:""},c.jsx(n.TextField,{defaultValue:h.text,multiline:!0,onChange:e=>{if(0===e.target.value.length){delete m.current.description;return}let t=new s.diff_match_patch().diff_main(h.text,e.target.value);h.text&&1===t.length?m.current.description="":m.current.description=new s.diff_match_patch().diff_toDelta(t)}})),c.jsx(n.Divider,{sx:{mt:2,mb:2}}),c.jsx(n.Typography,{variant:"h6",sx:{mb:2},children:"注释"}),c.jsx("ol",{children:t.filter(e=>-1!==e.index).length?t.filter(e=>-1!==e.index).map((e,t)=>c.jsx(l.Z,{content:e.text,onChange:t=>{t.diff||t.delete||t.insertAfter||t.insertBefore?m.current.comments[e.index]=t:delete m.current.comments[e.index]}},t)):c.jsx(l.Z,{content:"",onChange:e=>{e.diff||e.insertAfter||e.insertBefore?m.current.newComments=[...(e.insertBefore||[]).map(e=>e.text),...e.diff?[new s.diff_match_patch().diff_fromDelta("",e.diff).filter(e=>-1!==e[0]).map(e=>e[1]).join("")]:[],...(e.insertAfter||[]).map(e=>e.text)]:delete m.current.newComments}},"virtual")}),(0,c.jsxs)(n.Stack,{spacing:1,children:[c.jsx(n.Button,{variant:"contained",size:"small",sx:{width:80,mt:1},onClick:()=>{let e=JSON.stringify({articleId:u,publicationId:d,commitHash:p,patch:m.current}),t=`https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues/new?title=${encodeURIComponent(`[OCR patch]${i.title}[${x}][${u}][${d}]`)}&body=${encodeURIComponent(`{OCR补丁}
${e}
请复制以上代码在对比选项中粘贴进行预览：https://banned-historical-archives.github.io/articles/${u}
`)}`;window.open(t,"_blank")},children:"提交变更"}),(0,c.jsxs)(n.Typography,{children:["如果出现 Your request URL is too long 的错误，请点击",c.jsx(n.Button,{size:"small",onClick:e=>{let t=JSON.stringify({articleId:u,publicationId:d,commitHash:p,patch:m.current}),r=`{OCR补丁}
${t}
请复制以上代码在对比选项中粘贴进行预览：https://banned-historical-archives.github.io/articles/${u}`;navigator.clipboard.writeText(r);let n=`https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues/new?title=${encodeURIComponent(`[OCR patch]${i.title}[${x}][${u}][${d}]`)}`;window.open(n,"_blank"),g(r),b(e.currentTarget)},children:"复制代码并跳转"}),"，粘贴代码再提交。"]}),c.jsx(n.Typography,{children:"如果核对无误也可以提交，使其他人知道此文稿已经被校对（可多次提交，表示多次核对）"})]})]})}i()}catch(e){i(e)}})},4396:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{Z:()=>f});var n=r(5692),s=r(8618),a=r.n(s),l=r(2544),o=r.n(l),c=r(6689),u=r(7380),d=r(5158),p=r(9047),x=r(997),h=e([d,p]);function m({description:e,comments:t,contents:r}){let{0:i,1:s}=(0,c.useState)(!1),l=r.map(e=>{let r=[],i=t.filter(t=>t.part_idx===e.index),s=e.text,a=0,l=[];if(i.length){for(let e of i){let t=s.substr(a,e.offset-a);l.push(t),a+=t.length}a<s.length&&l.push(s.substr(a))}else l.push(s);let o=[];l.forEach((e,t)=>{if(o.push(x.jsx("span",{children:e},`${(0,d.bd)(e)}-${t}`)),r.push(e),i.length){let e=i.shift().index;r.push(`〔${e}〕`),o.push((0,x.jsxs)("a",{href:`#comment${e}`,style:{userSelect:"none"},children:[d.oW,e,d.Pc]},Math.random()))}}),e.type===u.zc.title?r.unshift("# "):e.type===u.zc.subtitle?r.unshift("## "):e.type===u.zc.subtitle2?r.unshift("### "):e.type===u.zc.subtitle3&&r.unshift("#### ");let c=e.id;if(e.type===u.zc.title)return x.jsx(n.Typography,{variant:"h5",sx:{textAlign:"center",margin:4},children:o},c);if(e.type===u.zc.appellation)return x.jsx(n.Typography,{variant:"body1",sx:{margin:.5,fontWeight:"bold"},children:o},c);if(e.type===u.zc.image)return x.jsx("img",{alt:"",src:e.text,style:{width:"50%",margin:"auto",marginTop:"1.25em"}},c);if(e.type===u.zc.image_description)return x.jsx(n.Typography,{variant:"subtitle1",sx:{textAlign:"center",marginBottom:"1.25em"},children:o},c);if(e.type===u.zc.subdate)return x.jsx(n.Typography,{variant:"subtitle1",sx:{textAlign:"center"},children:o},c);if(e.type===u.zc.place)return x.jsx(n.Typography,{variant:"subtitle1",sx:{textAlign:"center"},children:o},c);if(e.type===u.zc.authors)return x.jsx(n.Typography,{variant:"subtitle1",sx:{textAlign:"center"},children:o},c);else if(e.type===u.zc.signature)return x.jsx(n.Typography,{variant:"subtitle1",sx:{textAlign:"right"},children:o},c);else if(e.type===u.zc.subtitle)return x.jsx(n.Typography,{variant:"subtitle1",sx:{textAlign:"center",fontSize:"1.5em",fontWeight:"bold",margin:"1.25em 0 1.25em 0"},children:o},c);else if(e.type===u.zc.subtitle2)return x.jsx(n.Typography,{variant:"subtitle1",sx:{textAlign:"center",fontSize:"1.17em",fontWeight:"bold",margin:"1.25em 0 1.25em 0"},children:o},c);else if(e.type===u.zc.subtitle3)return x.jsx(n.Typography,{variant:"subtitle1",sx:{textAlign:"center",fontWeight:"bold",margin:"0.625em 0 0.625em 0"},children:o},c);else if(e.type===u.zc.subtitle4||e.type===u.zc.subtitle5)return x.jsx(n.Typography,{variant:"subtitle1",sx:{textAlign:"center"},children:o},c);else if(e.type===u.zc.paragraph)return x.jsx(n.Typography,{variant:"body1",sx:{textIndent:"2em",margin:.5},children:o},c);else if(e.type===u.zc.quotation)return x.jsx(n.Stack,{spacing:1,children:e.text.split("\n").filter(e=>e).map((e,t)=>x.jsx(n.Typography,{variant:"body1",sx:{color:"grey",padding:"0.625em 2.5em 0.625em 2.5em",borderLeft:"2px solid"},children:e},t))},c);else return x.jsx(n.Typography,{variant:"body1",sx:{textIndent:"2em",margin:.5},children:o},c)}),p=e?(0,x.jsxs)(x.Fragment,{children:[x.jsx(n.Divider,{sx:{mt:2,mb:2}}),x.jsx(n.Typography,{variant:"h6",sx:{mb:2},children:"描述"}),x.jsx(n.Stack,{spacing:1,children:e.split("\n").filter(e=>e).map((e,t)=>x.jsx(n.Typography,{variant:"body1",children:e},t))})]}):null,h=t.filter(e=>-1!==e.index).length?(0,x.jsxs)(x.Fragment,{children:[x.jsx(n.Divider,{sx:{mt:2,mb:2}}),x.jsx(n.Typography,{variant:"h6",sx:{mb:2},children:"注释"}),t.filter(e=>-1!==e.index).map(e=>(0,x.jsxs)(n.Stack,{direction:"row",id:`comment${e.index}`,children:[(0,x.jsxs)("span",{style:{userSelect:"none"},children:[d.oW,e.index,d.Pc]}),x.jsx(n.Stack,{spacing:1,children:e.text.split("\n").filter(e=>e).map((e,t)=>x.jsx(n.Typography,{variant:"body1",children:e},t))})]},e.id))]}):null;return x.jsx(x.Fragment,{children:(0,x.jsxs)("div",{style:{position:"relative"},children:[x.jsx(n.Button,{sx:{position:"absolute",top:4,left:0,minWidth:0,opacity:"0.5",width:"20px",height:"20px",borderRadius:"10px"},onClick:()=>{if(s(!i),i)speechSynthesis.cancel();else{let e=new SpeechSynthesisUtterance(r.map(e=>e.text).join("\n"));e.voice=speechSynthesis.getVoices().find(e=>"zh-CN"==e.lang),e.pitch=.5,e.rate=1,speechSynthesis.speak(e)}},children:i?x.jsx(o(),{}):x.jsx(a(),{})}),l,p,h]})})}function f({article:e,articleId:t,comments:r,patchable:i,contents:n,publicationId:s,publicationName:a,description:l}){return n=n.sort((e,t)=>e.index>t.index?1:-1),r=r.sort((e,t)=>e.index-t.index),i?x.jsx(p.Z,{articleId:t,article:e,comments:r,contents:n,description:l,publicationId:s,publicationName:a}):x.jsx(m,{description:l,comments:r,contents:n})}[d,p]=h.then?(await h)():h,i()}catch(e){i(e)}})},1333:(e,t,r)=>{r.d(t,{Z:()=>a});var i=r(8369),n=r.n(i),s=r(997);function a({authors:e}){return s.jsx(s.Fragment,{children:e.map(e=>s.jsx(n(),{onClick:()=>window.open(`/articles?author=${encodeURIComponent(e)}`,"_blank"),sx:{m:.3},label:e},e))})}},2466:(e,t,r)=>{r.d(t,{Z:()=>a});var i=r(7163),n=r.n(i),s=r(997);function a({diff:e}){return e?s.jsx(s.Fragment,{children:e.map((e,t)=>s.jsx(n(),{variant:"body1",sx:{margin:.5},children:e.map((e,t)=>s.jsx("span",{style:{color:1===e[0]?"green":-1===e[0]?"red":"inherit"},children:e[1]},t))},t))}):null}},3146:(e,t,r)=>{r.d(t,{Z:()=>d});var i=r(8369),n=r.n(i),s=r(7163),a=r.n(s),l=r(6689),o=r(5768),c=r.n(o),u=r(997);function d({tags:e}){let{0:t,1:r}=(0,l.useState)(null),{0:i,1:s}=(0,l.useState)(""),o=()=>{r(null)};return(0,u.jsxs)(u.Fragment,{children:[u.jsx(c(),{open:!!t,anchorEl:t,disableRestoreFocus:!0,sx:{pointerEvents:"none"},anchorOrigin:{vertical:"bottom",horizontal:"center"},children:u.jsx(a(),{sx:{p:2},children:i})}),e.map(e=>u.jsx(n(),{onMouseEnter:t=>{s(e.type),r(t.currentTarget)},onMouseLeave:o,onClick:()=>window.open(`/articles?tag=${encodeURIComponent(e.name)}`,"_blank"),sx:{m:.3},label:e.name},e.type+"##"+e.name))]})}},550:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{default:()=>V,getStaticPaths:()=>N,getStaticProps:()=>Y});var n=r(6689);r(8066);var s=r(968),a=r.n(s),l=r(2651),o=r.n(l),c=r(8125),u=r.n(c),d=r(911),p=r.n(d),x=r(8891),h=r.n(x),m=r(5612),f=r.n(m),g=r(7730),j=r.n(g),b=r(9271),y=r.n(b),v=r(8369),S=r.n(v),w=r(3819),k=r.n(w),C=r(8742),O=r.n(C),P=r(3646),_=r.n(P),B=r(7163),q=r.n(B),z=r(5876),T=r(2846),A=r(2466),I=r(3146),E=r(1333),$=r(5158),F=r(4396),D=r(4470),M=r(4822),R=r(997),Z=e([$,F]);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach(function(t){var i,n;i=t,n=r[t],(i=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}[$,F]=Z.then?(await Z)():Z,z.pdfjs.GlobalWorkerOptions.workerSrc="/pdfjs-dist/legacy/build/pdf.worker.min.js",process.env.COMMIT_HASH;let X="--preview-patch--";async function N(){let e=JSON.parse((0,D.readFileSync)((0,M.join)(process.cwd(),"article_indexes.json")).toString());return{paths:Object.keys(e).map(e=>({params:{id:e}})),fallback:!1}}let Y=async e=>{let{id:t}=e.params;return{props:{books:(await (await fetch("http://localhost:3001/get_article?id="+t)).json()).books}}};var U=function(e){return e.none="none",e.origin="origin",e.originProofread="originProofread",e.version="version",e}(U||{});function H(e){return[e.year||"",e.month||"",e.day||""].filter(e=>e).join(".")}var G=function(e){return e.line="逐行对比",e.literal="逐字对比",e.description_and_comments="描述和注释",e}(G||{});function V({books:e}){let{0:t,1:r}=(0,n.useState)(),i=(0,n.useRef)(e),{0:s,1:l}=(0,n.useState)(1),{0:c,1:d}=(0,n.useState)(!0),{0:x,1:m}=(0,n.useState)(null),{0:g,1:b}=(0,n.useState)(U.none),{0:v,1:w}=(0,n.useState)(e[e.length-1].id),{0:C,1:P}=(0,n.useState)(G.line),{0:B,1:T}=(0,n.useState)(e[0].id),D=(0,n.useCallback)((e,t)=>{i.current=i.current.filter(e=>e.id!=X),i.current.push({id:X,type:"",tags:[],files:[],name:"#OCR补丁预览#",article:(0,$.Az)(i.current.find(t=>t.id==e).article,t)})},[]);(0,n.useEffect)(()=>{let e=new URLSearchParams(location.search);e.get("publication_id")&&T(e.get("publication_id"))},[]);let M=(0,n.useMemo)(()=>(U.version,[]),[B,g,C,v]),Z=!!x;(global||window).location?.hostname;let L=i.current.find(e=>e.id==B),N=i.current.find(e=>e.id==v),V=L.article,Y=[];i.current.forEach(e=>{e.article.alias&&Y.push(e.article.alias)});let{description:J,parts:Q,comments:K,page_start:ee,page_end:et,comment_pivots:er}=V,ei=K.map((e,t)=>({text:e,id:t.toString(),offset:er[t]?.offset,index:er[t]?.index,part_idx:er[t]?.part_idx})),en=Q.map((e,t)=>W(W({},e),{},{index:t,id:t.toString()})),es=N.article.comments.map((e,t)=>W({text:e,id:t.toString()},er[t])),ea=N.article.parts.map((e,t)=>W(W({},e),{},{index:t,id:t.toString()})),el=new Map;if(i.current.forEach(e=>{e.tags.forEach(e=>{el.set(e.type+"##"+e.name,e)})}),(0,n.useEffect)(()=>{r(location.pathname.split("/").slice(-1)[0])},[]),!t)return null;let eo=[];eo.push(R.jsx(O(),{sx:{flex:1,overflowY:"scroll",p:1},children:R.jsx(F.Z,{article:V,articleId:t,publicationId:B,publicationName:L.name,description:J,comments:ei,contents:en,patchable:g===U.originProofread})},"version_a")),g===U.origin||g===U.originProofread?eo.push((0,R.jsxs)(O(),{sx:{flex:1,overflowY:"scroll"},children:[(0,R.jsxs)(O(),{direction:"row",spacing:"10px",sx:{position:"fixed",bottom:20,right:20,zIndex:1,opacity:.7},children:[R.jsx(k(),{onClick:()=>l(s+.1),variant:"contained",sx:{borderRadius:"100%",width:"50px",minWidth:"50px",height:"50px"},children:"+"}),R.jsx(k(),{onClick:()=>l(s-.1),variant:"contained",sx:{borderRadius:"100%",width:"50px",minWidth:"50px",height:"50px"},children:"-"})]}),"db"!==L.type?"pdf"===L.type?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(q(),{variant:"subtitle1",children:["来源文件(页码",ee,"-",et,")",R.jsx("a",{href:L.files[0],target:"__blank",children:"[下载]"})]}),R.jsx(z.Document,{file:L.files[0]||"",options:{cMapUrl:"/pdfjs-dist/cmaps/",cMapPacked:!0},children:Array(et-ee+1).fill(0).map((e,t)=>R.jsx(z.Page,{pageNumber:t+ee,width:500*s},t))})]}):"img"===L.type?L.files.filter((e,t)=>t+1>=ee&&t+1<=et).map(e=>R.jsx("img",{alt:"",src:e,width:500*s},e)):R.jsx(R.Fragment,{children:"未知类型"}):"无法预览（来自数据库文件）"]},"origin")):g===U.version&&eo.push((0,R.jsxs)(O(),{sx:{flex:1},children:[(0,R.jsxs)(h(),{children:[R.jsx(p(),{children:"对比目标"}),R.jsx(o(),{size:"small",value:v,input:R.jsx(j(),{label:"对比目标"}),onChange:e=>{w(e.target.value)},children:i.current.map(e=>R.jsx(y(),{value:e.id,children:e.name},e.id))})]}),R.jsx(O(),{sx:{overflowY:"scroll"},children:R.jsx(F.Z,{description:N.article.description,articleId:t,article:N.article,publicationId:v,comments:es,contents:ea})})]},"version_b"),(0,R.jsxs)(O(),{sx:{flex:1},children:[(0,R.jsxs)(h(),{children:[R.jsx(p(),{children:"对比模式"}),(0,R.jsxs)(o(),{size:"small",value:C,input:R.jsx(j(),{label:"对比模式"}),onChange:e=>{P(e.target.value)},children:[R.jsx(y(),{value:G.line,children:G.line}),R.jsx(y(),{value:G.literal,children:G.literal}),R.jsx(y(),{value:G.description_and_comments,children:G.description_and_comments})]})]}),R.jsx(O(),{sx:{overflowY:"scroll"},children:R.jsx(A.Z,{diff:M})})]},"result"));let ec=(0,R.jsxs)(R.Fragment,{children:[R.jsx(f(),{item:!0,xs:12,md:6,children:(0,R.jsxs)(O(),{direction:"row",spacing:1,alignItems:"center",children:[R.jsx(q(),{variant:"body1",children:"作者："}),R.jsx(O(),{direction:"row",sx:{overflowX:"scroll",flex:1},children:R.jsx(E.Z,{authors:V.authors})}),i.current.map(e=>R.jsx("img",{alt:"",style:{cursor:"pointer"},onClick:()=>window.open(`https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues?q=+${encodeURIComponent(`is:issue "${t}" "${e.id}"`)}+`,"_blank"),src:`https://img.shields.io/github/issues-search/banned-historical-archives/banned-historical-archives.github.io?style=for-the-badge&color=%23cc0000&label=%E6%A0%A1%E5%AF%B9%E8%AE%B0%E5%BD%95&query=${encodeURIComponent(`is:issue "${t}" "${e.id}"`)}`},e.id))]})}),R.jsx(f(),{item:!0,xs:12,md:3,children:(0,R.jsxs)(q(),{variant:"body1",sx:{overflowX:"scroll"},children:["时间：",V.is_range_date?`${H(V.dates[0])}-${H(V.dates[1])}`:V.dates.map(e=>H(e)).join(",")]})}),R.jsx(f(),{item:!0,xs:12,md:3,children:(0,R.jsxs)(O(),{direction:"row",alignItems:"center",children:[R.jsx(q(),{variant:"body1",children:"标签："}),R.jsx(O(),{direction:"row",spacing:1,alignItems:"center",sx:{flex:1,overflowX:"scroll"},children:R.jsx(I.Z,{tags:Array.from(el.values())})})]})}),R.jsx(f(),{item:!0,xs:12,md:6,children:(0,R.jsxs)(O(),{direction:"row",alignItems:"center",spacing:1,children:[R.jsx(q(),{variant:"body1",children:"选择来源："}),R.jsx(O(),{direction:"row",spacing:1,sx:{flex:1,overflowX:"scroll"},children:i.current.map(e=>R.jsx(S(),{label:e.name,variant:B===e.id?"filled":"outlined",color:B===e.id?"primary":"default",onClick:t=>{T(e.id)}},e.id))}),R.jsx(k(),{variant:"outlined","aria-controls":Z?"basic-menu":void 0,"aria-haspopup":"true",size:"small","aria-expanded":Z?"true":void 0,onClick:e=>m(e.currentTarget),children:"对比"}),(0,R.jsxs)(u(),{id:"basic-menu",anchorEl:x,open:Z,onClose:()=>m(null),MenuListProps:{"aria-labelledby":"basic-button"},children:[R.jsx(y(),{onClick:()=>{b(U.origin),m(null)},children:"对比原始文件"}),R.jsx(y(),{onClick:()=>{b(U.originProofread),m(null)},children:"对比原始文件并校对"}),R.jsx(y(),{onClick:()=>{w(1===i.current.length?i.current[0].id:i.current.find(e=>e.id!==L.id).id),b(U.version),m(null)},children:"对比不同来源解析后的文本"}),R.jsx(y(),{onClick:()=>{let e=prompt("导入代码")||"";e=(e=e.replace(/^\{OCR补丁\}/,"")).substr(0,e.lastIndexOf("}")+1);try{let t=JSON.parse(e);D(t.publicationId,t.patch),w(X),T(t.publicationId),b(U.version),m(null)}catch(e){alert("解析错误")}},children:"导入代码对比OCR校对结果"}),R.jsx(y(),{onClick:()=>{b(U.none),m(null)},children:"取消"})]})]})})]});return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(O(),{sx:{height:"100%",boxSizing:"border-box",background:"white",zIndex:1,top:0,left:0},pb:0,children:[(0,R.jsxs)(f(),{container:!0,alignItems:"center",sx:{pt:2,pl:2,pr:2},spacing:2,children:[R.jsx(f(),{item:!0,xs:10,md:6,children:(0,R.jsxs)(q(),{variant:"body1",sx:{overflowX:"scroll"},children:["标题：",V.title,Y.length?`(别名:${Y.join(",")})`:""]})}),R.jsx(f(),{item:!0,xs:2,sx:{display:{md:"none",xs:"flex"}},children:R.jsx(k(),{onClick:()=>d(!c),children:c?"隐藏":"展开"})}),c?ec:null]}),R.jsx(O(),{direction:"row",divider:R.jsx(_(),{orientation:"vertical",flexItem:!0}),spacing:2,sx:{flex:1,overflow:"auto",p:2},children:eo})]}),R.jsx(a(),{children:(0,R.jsxs)("title",{children:[V.title," - 和谐历史档案馆 Banned Historical Archives"]})})]})}V.getLayout=e=>R.jsx(T.Z,{children:e}),i()}catch(e){i(e)}})},7380:(e,t,r)=>{r.d(t,{Qy:()=>i,zc:()=>n});let i=function(e){return e.articleCategory="文稿大类",e.articleType="文稿类型",e.place="地点",e.character="人物",e.issuer="出版方/发行方",e.subject="主题/事件",e.recorder="记录",e.reviewer="审核",e.translator="翻译",e.reprint="翻印/传抄",e}({}),n=function(e){return e.appellation="appellation",e.title="title",e.authors="authors",e.place="place",e.subtitle="subtitle",e.subtitle2="subtitle2",e.subtitle3="subtitle3",e.subtitle4="subtitle4",e.subtitle5="subtitle5",e.subdate="subdate",e.paragraph="paragraph",e.quotation="quotation",e.signature="signature",e.image="image",e.image_description="image_description",e}({})},1972:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>f,default:()=>p,getServerSideProps:()=>m,getStaticPaths:()=>h,getStaticProps:()=>x,reportWebVitals:()=>g,routeModule:()=>w,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>S,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>j});var n=r(7093),s=r(5244),a=r(1323),l=r(1445),o=r.n(l),c=r(1562),u=r(550),d=e([u]);u=(d.then?(await d)():d)[0];let p=(0,a.l)(u,"default"),x=(0,a.l)(u,"getStaticProps"),h=(0,a.l)(u,"getStaticPaths"),m=(0,a.l)(u,"getServerSideProps"),f=(0,a.l)(u,"config"),g=(0,a.l)(u,"reportWebVitals"),j=(0,a.l)(u,"unstable_getStaticProps"),b=(0,a.l)(u,"unstable_getStaticPaths"),y=(0,a.l)(u,"unstable_getStaticParams"),v=(0,a.l)(u,"unstable_getServerProps"),S=(0,a.l)(u,"unstable_getServerSideProps"),w=new n.PagesRouteModule({definition:{kind:s.x.PAGES,page:"/articles/[id]",pathname:"/articles/[id]",bundlePath:"",filename:""},components:{App:c.default,Document:o()},userland:u});i()}catch(e){i(e)}})},1914:e=>{e.exports=require("@mui/icons-material/Block")},9254:e=>{e.exports=require("@mui/icons-material/GitHub")},3365:e=>{e.exports=require("@mui/icons-material/Menu")},4789:e=>{e.exports=require("@mui/icons-material/MenuBook")},2544:e=>{e.exports=require("@mui/icons-material/PauseCircle")},8618:e=>{e.exports=require("@mui/icons-material/PlayCircle")},8017:e=>{e.exports=require("@mui/icons-material/Search")},5692:e=>{e.exports=require("@mui/material")},3882:e=>{e.exports=require("@mui/material/AppBar")},19:e=>{e.exports=require("@mui/material/Box")},3819:e=>{e.exports=require("@mui/material/Button")},8369:e=>{e.exports=require("@mui/material/Chip")},4475:e=>{e.exports=require("@mui/material/Container")},3646:e=>{e.exports=require("@mui/material/Divider")},7898:e=>{e.exports=require("@mui/material/Drawer")},8891:e=>{e.exports=require("@mui/material/FormControl")},5612:e=>{e.exports=require("@mui/material/Grid")},7934:e=>{e.exports=require("@mui/material/IconButton")},8855:e=>{e.exports=require("@mui/material/InputBase")},911:e=>{e.exports=require("@mui/material/InputLabel")},4192:e=>{e.exports=require("@mui/material/List")},834:e=>{e.exports=require("@mui/material/ListItem")},1011:e=>{e.exports=require("@mui/material/ListItemButton")},8315:e=>{e.exports=require("@mui/material/ListItemText")},8125:e=>{e.exports=require("@mui/material/Menu")},9271:e=>{e.exports=require("@mui/material/MenuItem")},7730:e=>{e.exports=require("@mui/material/OutlinedInput")},5768:e=>{e.exports=require("@mui/material/Popover")},2651:e=>{e.exports=require("@mui/material/Select")},441:e=>{e.exports=require("@mui/material/Skeleton")},8742:e=>{e.exports=require("@mui/material/Stack")},1431:e=>{e.exports=require("@mui/material/Toolbar")},7163:e=>{e.exports=require("@mui/material/Typography")},8442:e=>{e.exports=require("@mui/material/styles")},8066:e=>{e.exports=require("diff-match-patch")},4470:e=>{e.exports=require("fs-extra")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},5876:e=>{e.exports=require("react-pdf")},997:e=>{e.exports=require("react/jsx-runtime")},6555:e=>{e.exports=import("uuid")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},4822:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[445,1,563],()=>r(1972));module.exports=i})();